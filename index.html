<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="时刻用一颗谦卑的心来面对这个世界的人和事，在自己所建立的原则的基础上努力做事，人生终将美满。">
<meta property="og:type" content="website">
<meta property="og:title" content="戴建林">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="戴建林">
<meta property="og:description" content="时刻用一颗谦卑的心来面对这个世界的人和事，在自己所建立的原则的基础上努力做事，人生终将美满。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="戴建林">
<meta name="twitter:description" content="时刻用一颗谦卑的心来面对这个世界的人和事，在自己所建立的原则的基础上努力做事，人生终将美满。">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> 戴建林 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-80088746-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">戴建林</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">DaiJianlin’s Blog</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/04/rails101学习第四次/" itemprop="url">
                  rails101学习第四次
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-04T08:39:48+08:00" content="2016-12-04">
              2016-12-04
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/04/rails101学习第四次/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/12/04/rails101学习第四次/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Rails101第四遍"><a href="#Rails101第四遍" class="headerlink" title="Rails101第四遍"></a>Rails101第四遍</h1><h2 id="如何初始化git"><a href="#如何初始化git" class="headerlink" title="如何初始化git"></a>如何初始化git</h2><p>git init-&gt; git add . -&gt; git commit -m “Initial Commit”</p>
<h2 id="如何新建分支"><a href="#如何新建分支" class="headerlink" title="如何新建分支"></a>如何新建分支</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout -b branchname</div></pre></td></tr></table></figure>
<h2 id="如何为项目穿上bootstrap"><a href="#如何为项目穿上bootstrap" class="headerlink" title="如何为项目穿上bootstrap"></a>如何为项目穿上bootstrap</h2><p>gemfile文件中的group :development, :test do部分加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem &apos;bootstrap-sass&apos;</div></pre></td></tr></table></figure>
<p>之后执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bundle install</div></pre></td></tr></table></figure>
<h2 id="改application-css为application-scss"><a href="#改application-css为application-scss" class="headerlink" title="改application.css为application.scss"></a>改application.css为application.scss</h2><p>why?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv app/assets/stylesheets/application.css app/assets/stylesheets/application.scss</div></pre></td></tr></table></figure>
<p>在里面加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">import &apos;bootstrap-sprockets&apos;;</div><div class="line">import &apos;bootstrap&apos;;</div></pre></td></tr></table></figure>
<p>git add .</p>
<p>git commit -m “add bootstrap to project”</p>
<p>解说：</p>
<blockquote>
<ul>
<li>Bootstrap 是一个有名的 CSS 框架，提供了很多的现成元件样式，而且也是很多程式设计师开发程式首选的“制服”。</li>
<li>Bootstrap 的官网网址在：<a href="http://getbootstrap.com/" target="_blank" rel="external">http://getbootstrap.com/</a>，你可以在这里看到更多范例，以及用法。</li>
<li>以后如果你想要修改你的“按钮样式”，或者扩充一些新的功能，可以回到这个网站上面查询功能。</li>
<li>不过现在先不要在这里玩到迷路了。先继续你的 Rails 练习作业吧！</li>
</ul>
<p>css 与 scss 有什么不同？</p>
<ul>
<li>SCSS 是一套“程式语言”，可以用来产生 CSS。意思是你可以写程式“产生 CSS”，提供一些 CSS 原生没有办法的进阶作法。不过在这章你只要理解成为，我们为了要“挂上”bootstrap，所以必须要用到 scss</li>
</ul>
</blockquote>
<h2 id="套用Bootstrap的html样式"><a href="#套用Bootstrap的html样式" class="headerlink" title="套用Bootstrap的html样式"></a>套用Bootstrap的html样式</h2><p>新增文件夹</p>
<p>mkdir app/views/common</p>
<p>新增navbar</p>
<p>touch app/views/common/_navbar.html.erb</p>
<p>里面内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;nav class=&quot;navbar navbar-default&quot; role=&quot;navigation&quot;&gt;</div><div class="line">	&lt;div class=&quot;container-fluid&quot;&gt;</div><div class="line">		&lt;!-- Brand and toggle get grouped for better mobile display--&gt;</div><div class="line">		&lt;div class=&quot;navbar-header&quot;&gt;</div><div class="line">			&lt;a class=&quot;navbar-brand&quot; href=&quot;/&quot;&gt;Rails 104&lt;/a&gt;</div><div class="line">		&lt;/div&gt;</div><div class="line">		&lt;!-- Collect the nav links, forms, and other content for toggling--&gt;</div><div class="line">		&lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;bs-example-navbar-collapse-1&quot;&gt;</div><div class="line">		    &lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt;</div><div class="line">		    	&lt;li&gt;</div><div class="line">		    		&lt;%= link_to(&quot;登入&quot;, &apos;#&apos;)%&gt;</div><div class="line">		    	&lt;/li&gt;</div><div class="line">		    &lt;/ul&gt;</div><div class="line">			</div><div class="line">		&lt;/div&gt;</div><div class="line">		&lt;!-- /.navbar-collapse --&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">	&lt;!-- /.container-fluid --&gt;</div><div class="line">&lt;/nav&gt;</div></pre></td></tr></table></figure>
<p>原来class里面的内容就是参考<a href="https://getbootstrap.com/components/?#navbar-default" target="_blank" rel="external">https://getbootstrap.com/components/?#navbar-default</a> 做出来的。</p>
<p>新建个footer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch app/views/common/_footer.html.erb</div></pre></td></tr></table></figure>
<p>在这个文件里加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;footer class=&quot;container&quot; style=&quot;margin-top: 100px;&quot;&gt;</div><div class="line">	&lt;p class=&quot;text-center&quot;&gt; Copyright @2016 Rails104</div><div class="line">		&lt;br&gt; Designed by </div><div class="line">		&lt;a href=&quot;http://daijianlin.com&quot; target=_new&gt;Marcfly&lt;/a&gt;</div><div class="line">	&lt;/p&gt;</div><div class="line">&lt;/footer&gt;</div></pre></td></tr></table></figure>
<p>修改全域HTML样式application即，app/views/layouts/application.html.erb，把body部分的内容改成如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">  &lt;div class=&quot;container-fluid&quot;&gt;</div><div class="line">  	&lt;%= render &quot;common/navbar&quot; %&gt;</div><div class="line">  	&lt;%= yield %&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">  &lt;%= render &quot;common/footer&quot; %&gt;</div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure>
<p>产生一个新的空 Hello World 页面 （放在 weclome#index)</p>
<p>新增一个welcome controller</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g controller welcome</div></pre></td></tr></table></figure>
<p>新增一个空的Helloworld域名</p>
<p>touch app/views/welcome/index.html.erb</p>
<p>填入</p>
<h1> Hello World!</h1>



<p>在 requre_tree 上加入 //= require bootstrap/alert</p>
<p>app/assets/javascripts/application.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">//=require bootstrap/alert</div></pre></td></tr></table></figure>
<p>application.js 是用来做什么用的？这里就是加上提示信息？</p>
<p>新增app/views/common/_flashes.html.erb 这个partial</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch app/views/common/_flashes.html.erb</div></pre></td></tr></table></figure>
<p>在这个文件中填入</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;%<span class="ruby"> <span class="keyword">if</span> flash.any? </span>%&gt;</div><div class="line">  &lt;%<span class="ruby"> user_facing_flashes.each <span class="keyword">do</span> <span class="params">|key, value|</span> </span>%&gt;</div><div class="line">    &lt;div class="alert alert-dismissable alert-&lt;%=<span class="ruby"> flash_class(key) </span>%&gt;"&gt;</div><div class="line">      &lt;button class="close" data-dismiss="alert"&gt;×&lt;/button&gt;</div><div class="line">      &lt;%=<span class="ruby"> value </span>%&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;</div><div class="line">&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;</div></pre></td></tr></table></figure>
<p>这个flash到底是什么东西？</p>
<p>在加入一个helper： app/helpers/flashes_helper.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch app/helpers/flashes_helper.rb</div></pre></td></tr></table></figure>
<p>在这个文件中加入：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">FlashesHelper</span></span></div><div class="line">  FLASH_CLASSES = &#123; <span class="symbol">alert:</span> <span class="string">"danger"</span>, <span class="symbol">notice:</span> <span class="string">"success"</span>, <span class="symbol">warning:</span> <span class="string">"warning"</span>&#125;.freeze</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">flash_class</span><span class="params">(key)</span></span></div><div class="line">    FLASH_CLASSES.fetch key.to_sym, key</div><div class="line">  <span class="keyword">end</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">user_facing_flashes</span></span></div><div class="line">    flash.to_hash.slice <span class="string">"alert"</span>, <span class="string">"notice"</span>,<span class="string">"warning"</span> </div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>在application.html.erb中加入flash这个partial</p>
<p>即在&lt;%= yield %&gt;前加入&lt;% render “common/flashes” %&gt;</p>
<p>app/views/layout/application.html.erb，变成</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">    &lt;div class="container-fluid"&gt;</div><div class="line">    	&lt;%=<span class="ruby"> render <span class="string">"common/navbar"</span> </span>%&gt;</div><div class="line">    	&lt;%=<span class="ruby"> render <span class="string">"common/flash"</span></span>%&gt;</div><div class="line">    	&lt;%=<span class="ruby"> <span class="keyword">yield</span> </span>%&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;%=<span class="ruby"> render <span class="string">"common/footer"</span> </span>%&gt;</div><div class="line">  &lt;/body&gt;</div></pre></td></tr></table></figure>
<p>git存档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git commit -m &quot;add bootstrap flash function&quot;</div></pre></td></tr></table></figure>
<p>测试flash helper功能</p>
<p>修改controller中的welcome_controller.rb。加入flash[:notice] = “你好”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class WelcomeController &lt; ApplicationController</div><div class="line">  def index</div><div class="line">    flash[:notice] = &quot;早安！你好！&quot;</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>备注：</p>
<p>flash[:alert],flash[:notice]一般与redirect_to一起用，而不能与render一起用。</p>
<p>redirect_to是重定向，会重新发起请求，比render多了一次请求。flash[:alert],flash[:notice]只会出现在接下面的一个页面中。</p>
<p>而render是服务器端转发，客户端不会重新发送请求，比redirect_to少了一次请求。所以一旦一起用，结果是接下来两个页面都有flash[:alert],flash[:notice]，第三个页面时才会消失。</p>
<p>正确的做法是render搭配flash.now[:alert],flash.now[:notice]一起用</p>
<p><strong>参考：git 常用指令教学</strong></p>
<p>Attachment Blocks</p>
<p>这边是一些常用的 git 指令，常用就会自然记起来，不用硬背，你可以在遇到问题的时候再回来看这篇。</p>
<p>存档：</p>
<p>最一开始的时候要先执行存档：</p>
<p>cd 你的专案资料夹名称</p>
<p>git init</p>
<p>git add .</p>
<p>git commit -m “对于修改部分的简要叙述”</p>
<p>新增一个分支：</p>
<p>git checkout -b 你想取的分之名称</p>
<p>这样你的存档会自动被保留在这个分支里。</p>
<p>如果不小心做烂了，可以直接切回上一个分支去做。</p>
<p>切换分支：</p>
<p>git checkout 你想要切换到的分支名称</p>
<p>举例来说，假设你从01开始做，做到02的时候烂掉了</p>
<p>你可以 git checkout 01 回到01再重新开始做</p>
<p>那这个烂掉的02要怎么办呢？虽然你可以产生另一个新的02-1，但还是建议把错误的删除掉，这样才不会做到最后变得乱七八糟的。</p>
<p>删除掉brach的方法：</p>
<p>先离开你要删除的分支，接着执行 git branch -d 你要删除的分支名称</p>
<p>就可以了。</p>
<p>ch02</p>
<p>接下来</p>
<p>git checkout -b ch02</p>
<p>设计Group的model架构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g model group title:string description:text</div></pre></td></tr></table></figure>
<p>建立资料库且执行rake db:migrate</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
<p>建立groups controller</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g controller groups</div></pre></td></tr></table></figure>
<p>建立index action及index的view</p>
<p>修改app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class GroupsController &lt; ApplicationController</div><div class="line">  def index</div><div class="line">    @groups = Group.all</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>touch app/views/groups/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-12&quot;&gt;</div><div class="line">  &lt;div class=&quot;group&quot;&gt;</div><div class="line">    &lt;%= link_to(&quot;New group&quot;, new_group_path, class: &quot;btn btn-primary pull-right&quot;) %&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">  &lt;table class=&quot;table table-hover&quot;&gt;</div><div class="line">    &lt;thead&gt;</div><div class="line">      &lt;tr&gt;</div><div class="line">        &lt;td&gt;#&lt;/td&gt;</div><div class="line">        &lt;td&gt;Title&lt;/td&gt;</div><div class="line">        &lt;td&gt;Description&lt;/td&gt;</div><div class="line">      &lt;/tr&gt;</div><div class="line">    &lt;/thead&gt;</div><div class="line">    &lt;tbody&gt;</div><div class="line">      &lt;% @groups.each do |group| %&gt;</div><div class="line">        &lt;tr&gt;</div><div class="line">          &lt;td&gt;#&lt;/td&gt;</div><div class="line">          &lt;td&gt;&lt;%= link_to(group.title, group_path(group)) %&gt;&lt;/td&gt;</div><div class="line">          &lt;td&gt;&lt;%= group.description %&gt;&lt;/td&gt;</div><div class="line">          &lt;td&gt;</div><div class="line">              &lt;%= link_to(&quot;Edit&quot;, edit_group_path(group), class: &quot;btn btn-sm btn-default&quot;)%&gt;</div><div class="line">              &lt;%= link_to(&quot;Delete&quot;, group_path(group),    class: &quot;btn btn-sm btn-default&quot;, </div><div class="line">                          method: :delete, data: &#123; confirm: &quot;Are you sure?&quot; &#125; )%&gt;</div><div class="line">          &lt;/td&gt;</div><div class="line">        &lt;/tr&gt;</div><div class="line">      &lt;% end %&gt;</div><div class="line">    &lt;/tbody&gt;</div><div class="line">  &lt;/table&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>在routes.rb的root ‘welcome#index’前加上一行resources :groups</p>
<p>即变成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Rails.application.routes.draw do</div><div class="line">  resources :groups</div><div class="line">  root &apos;welcome#index&apos;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这样以后，打开<a href="http://localhost:3000/groups就快要看到效果。" target="_blank" rel="external">http://localhost:3000/groups就快要看到效果。</a></p>
<p>接下来通过rails console来加一些东西上去。</p>
<p>(先spring stop)</p>
<p>rails console</p>
<p>后，</p>
<p>Group.create(title: “Board 1”, description: “Board 1 body”)</p>
<p>Group.create(title: “Board 2”, description: “Board 2 body”)</p>
<p>git 存档</p>
<p>git add .</p>
<p>git commit -m “create group index”</p>
<p>把首页换成 groups</p>
<p>root ‘welcome#index’改成</p>
<p>root ‘groups#index’  </p>
<p>存档</p>
<p>git add .</p>
<p>git commit -m “replace root with groups#index”</p>
<h2 id="ch03"><a href="#ch03" class="headerlink" title="ch03"></a>ch03</h2><h3 id="添加新增功能"><a href="#添加新增功能" class="headerlink" title="添加新增功能"></a>添加新增功能</h3><p>git checkout -b ch03</p>
<p>step1. groups_controller中加入new action</p>
<p>app/controllers/groups_controller.rb</p>
<p>step2. 建立new action表单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch app/views/groups/new.html.erb</div></pre></td></tr></table></figure>
<p>在这个新加的文件中添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-4 col-md-offset-4&quot;&gt;</div><div class="line">    &lt;h2&gt;新增讨论版&lt;/h2&gt;</div><div class="line">    &lt;hr&gt;</div><div class="line">    &lt;%= form_for @group do |f| %&gt;</div><div class="line">    标题</div><div class="line">    &lt;%= f.text_field :title %&gt;</div><div class="line">    &lt;br&gt;</div><div class="line">    叙述</div><div class="line">    &lt;br&gt;</div><div class="line">    &lt;%= f.text_area :description %&gt;</div><div class="line">    &lt;br&gt;</div><div class="line">    &lt;%= f.submit &quot;Submit&quot;, :disable_with =&gt; &apos;Submiting...&apos; %&gt;</div><div class="line">    &lt;% end %&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>git存档</p>
<p>git add .</p>
<p>git commit -m “implement groups#new”</p>
<p>解释：</p>
<p>form_for 是 Rails 的表单产生器，Rails 会智能的根据你指定的“物件”@group 与字段 f.text_field :title 展开</p>
<p>建立create action</p>
<p>在groups_controller.rb中添加如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">def create</div><div class="line">	@group = Group.new(groups_params)</div><div class="line">  @group.save</div><div class="line"></div><div class="line">  redirect_to groups_path  	</div><div class="line">end</div><div class="line"></div><div class="line">def groups_params</div><div class="line">	params.require(:group).permit(:title, :description)</div><div class="line">	</div><div class="line">end</div></pre></td></tr></table></figure>
<p>git存档</p>
<p>git add .</p>
<p>git commit -m “implement groups#create”</p>
<h2 id="添加浏览功能"><a href="#添加浏览功能" class="headerlink" title="添加浏览功能"></a>添加浏览功能</h2><p>groups_controller.rb中添加show方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def show</div><div class="line">	@group = Group.find(params[:id])</div><div class="line">end</div></pre></td></tr></table></figure>
<p>在views中添加show.html.erb，且添加如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-12&quot;&gt;</div><div class="line">  &lt;div class=&quot;group&quot;&gt;</div><div class="line">    &lt;%= link_to(&quot;Edit&quot;, edit_group_path(@group), class: &quot;btn btn-primary pull-right&quot;)%&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">  &lt;h2&gt;&lt;%= @group.title %&gt;&lt;/h2&gt;</div><div class="line">  &lt;p&gt;&lt;%= @group.description %&gt;&lt;/p&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<h2 id="添加修改功能"><a href="#添加修改功能" class="headerlink" title="添加修改功能"></a>添加修改功能</h2><p>在groups_controller.rb中加入edit方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def edit</div><div class="line">  @group = Group.find(params[:id])</div><div class="line">end</div></pre></td></tr></table></figure>
<p>建表单edit.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch app/views/groups/edit.html.erb</div></pre></td></tr></table></figure>
<p>并写入如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-4 col-md-offset-4&quot;&gt;</div><div class="line">    &lt;h2&gt;编辑讨论版&lt;/h2&gt;</div><div class="line">    &lt;hr&gt;</div><div class="line">    &lt;%= form_for @group do |f| %&gt;</div><div class="line">    标题</div><div class="line">    &lt;%= f.text_field :title %&gt;</div><div class="line">    &lt;br&gt;</div><div class="line">    叙述</div><div class="line">    &lt;br&gt;</div><div class="line">    &lt;%= f.text_area :description %&gt;</div><div class="line">    &lt;br&gt;</div><div class="line">    &lt;%= f.submit &quot;Submit&quot;, :disable_with =&gt; &apos;Submiting...&apos; %&gt;</div><div class="line">    &lt;% end %&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>git存档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git commit -m &quot;implement groups#edit&quot;</div></pre></td></tr></table></figure>
<p>建立udpate action</p>
<p>在groups_controller.rb中加入方法update</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">def update</div><div class="line">  @group = Group.find(params[:id])</div><div class="line">  @group.udpate(group_params)</div><div class="line">  </div><div class="line">  redirect_to groups_path</div><div class="line">end</div></pre></td></tr></table></figure>
<p>git 存档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git commit -m &quot;implement group#update&quot;</div></pre></td></tr></table></figure>
<h2 id="实现删除功能"><a href="#实现删除功能" class="headerlink" title="实现删除功能"></a>实现删除功能</h2><p>在groups_controller.rb中添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">def destroy</div><div class="line">	@group = Group.find(params[:id])</div><div class="line">	@group.destroy</div><div class="line">	flash[:alert] = &quot;Group deleted&quot;</div><div class="line">	redirect_to groups_path</div><div class="line">end</div></pre></td></tr></table></figure>
<p>git 存档</p>
<p>git add .</p>
<p>git commit -m “implement groups#destroy “</p>
<h2 id="限制标题为空的文章"><a href="#限制标题为空的文章" class="headerlink" title="限制标题为空的文章"></a>限制标题为空的文章</h2><p>在 Group model 加入“标题限制”</p>
<p>修改 app/models/group.rb 让它长得像这样</p>
<p>app/models/group.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class Group &lt; ActiveRecord::Base</div><div class="line"></div><div class="line"> validates :title, presence: true</div><div class="line"></div><div class="line">end</div></pre></td></tr></table></figure>
<p>把groups_controller.rb中的create方法修改成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">def create</div><div class="line">	@group = Group.new(group_params)</div><div class="line">  </div><div class="line">  if @group.save</div><div class="line"></div><div class="line">  redirect_to groups_path  </div><div class="line">  else</div><div class="line">  render :new</div><div class="line">  end	</div><div class="line">end</div></pre></td></tr></table></figure>
<p>然后修改当做提到的new</p>
<p>在 form_for 下方加入这一段：</p>
<p>app/views/groups/new.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;% if @group.errors.any? %&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">  &lt;% @group.errors.full_messages.each do |msg| %&gt;</div><div class="line">    &lt;li&gt;&lt;%= msg %&gt;&lt;/li&gt;</div><div class="line">  &lt;% end %&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure>
<p>git 存档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git commit -m &quot;add validation to title&quot;</div></pre></td></tr></table></figure>
<p>修改edit action</p>
<p>把groups_controller.rb中的udpate方法改成这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">def update</div><div class="line">    @group = Group.find(params[:id])</div><div class="line">    if @group.update(group_params)</div><div class="line">      redirect_to groups_path, notice: &quot;Update Success&quot;</div><div class="line">    else</div><div class="line">      render :edit</div><div class="line">    end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>在edit.html.erb中的form_for下方也加入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;% if @group.errors.any? %&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">  &lt;% @group.errors.full_messages.each do |msg| %&gt;</div><div class="line">    &lt;li&gt; &lt;%= msg %&gt; &lt;/li&gt;</div><div class="line">  &lt;% end %&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure>
<p>git存档：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git commit -m &quot;add validation to title apply to edit/update&quot;</div></pre></td></tr></table></figure>
<p>解说：</p>
<p>validates :title, presence: true 是什么意思？</p>
<ul>
<li>这是 Rails 的 Model 内建的“验证”函式。意思是“不得为空”。</li>
<li>其实 Rails 还有很多内建验质函式，你可以看这里：<a href="http://guides.rubyonrails.org/active_record_validations.html" target="_blank" rel="external">http://guides.rubyonrails.org/active_record_validations.html</a></li>
</ul>
<h2 id="共用表单"><a href="#共用表单" class="headerlink" title="共用表单"></a>共用表单</h2><p>创建app/views/groups/_form.html.erb</p>
<p>touch app/views/groups/_form.html.erb</p>
<p>把下面内容放到_form.html.erb中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;%= form_for @group do |f| -%&gt;</div><div class="line">&lt;% if @group.errors.any? %&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">  &lt;% @group.errors.full_messages.each do |msg| %&gt;</div><div class="line">    &lt;li&gt;&lt;%= msg %&gt;&lt;/li&gt;</div><div class="line">  &lt;% end %&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line">&lt;% end %&gt;</div><div class="line">标题</div><div class="line">&lt;%= f.text_field :title %&gt;</div><div class="line">&lt;br&gt;</div><div class="line">叙述</div><div class="line">&lt;br&gt;</div><div class="line">&lt;%= f.text_area :description %&gt;</div><div class="line">&lt;br&gt;</div><div class="line">&lt;%= f.submit &quot;Submit&quot;, :disable_with =&gt; &apos;Submiting...&apos; %&gt;</div><div class="line">&lt;% end -%&gt;</div></pre></td></tr></table></figure>
<p>修改app/views/groups/new.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-4 col-md-offset-4&quot;&gt;</div><div class="line">    &lt;h2&gt;新增讨论版&lt;/h2&gt;</div><div class="line">    &lt;hr&gt;</div><div class="line">    &lt;%= render &quot;form&quot; %&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>修改app/views/groups/edit.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-4 col-md-offset-4&quot;&gt;</div><div class="line">    &lt;h2&gt;编辑讨论版&lt;/h2&gt;</div><div class="line">    &lt;hr&gt;</div><div class="line">    &lt;%= render &quot;form&quot; %&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>git存档</p>
<p>git add .</p>
<p>git commit -m “move form to partial”</p>
<p>&lt;%= render “form” %&gt;是&lt;%= render :partial =&gt; “form” %&gt;的缩写</p>
<p>意思是我要引用 Partial (局部）页面的方式。因为我们发现有很大量的程式码重复，所以可以用这样的方式收纳。</p>
<p>它的规则是同目录底下的 _xxxx.html.erb</p>
<h2 id="将表单体会成Bootstrap提供的版型"><a href="#将表单体会成Bootstrap提供的版型" class="headerlink" title="将表单体会成Bootstrap提供的版型"></a>将表单体会成Bootstrap提供的版型</h2><p>修改_form.html.erb，换成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;%= form_for @group do |f| %&gt;</div><div class="line">&lt;div class=&quot;form-group&quot;&gt;</div><div class="line">    &lt;div class=&quot;form-group string optional&quot;&gt;</div><div class="line">        &lt;%= f.label &quot;title&quot;, :class =&gt; &quot;string optional control-label&quot; %&gt;</div><div class="line">        &lt;%= f.text_field :title, :class =&gt; &quot;string optional form-control form-control&quot; %&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;div class=&quot;form-group string optional&quot;&gt;</div><div class="line">        &lt;%= f.label &quot;description&quot;, :class =&gt; &quot;string optional control-label&quot; %&gt;</div><div class="line">        &lt;%= f.text_area :description, :class =&gt; &quot;string optional form-control&quot; %&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">&lt;%= f.submit &quot;Submit&quot;, class: &quot;btn btn-primary&quot;, data: &#123; disable_with: &quot;Submitting...&quot; &#125; %&gt;</div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure>
<p>git存档</p>
<p>git add .</p>
<p>git commit -m “style form with bootstrap”</p>
<p>使用simple_form gem来简化表单</p>
<p>在Gemfile总加入</p>
<p>gem “simple_form”</p>
<p>执行</p>
<p>bundle install</p>
<p>安装simple_form for bootstrap的设定</p>
<p>执行：</p>
<p>rails generate simple_form:install —bootstrap</p>
<p>重启rails s</p>
<p>这个指令会产生两个文件：</p>
<ul>
<li><p>config/initializers/simple_form.rb</p>
</li>
<li><p>config/initializers/simple_form_bootstrap.rb （这个是 Bootstrap 表单的“布景”)</p>
<p>​</p>
</li>
</ul>
<p>把_form.html.erb的内容改为：</p>
<p>app/views/groups/_form.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;%= simple_form_for @group do |f| %&gt;</div><div class="line"></div><div class="line">  &lt;div class=&quot;form-group&quot;&gt;</div><div class="line"></div><div class="line">    &lt;%= f.input :title, input_html: &#123; class: &quot;form-control&quot;&#125; %&gt;</div><div class="line"></div><div class="line">    &lt;%= f.input :description, input_html: &#123; class: &quot;form-control&quot;&#125; %&gt;</div><div class="line"></div><div class="line">  &lt;/div&gt;</div><div class="line"></div><div class="line">  &lt;%= f.submit &quot;Submit&quot;, class: &quot;btn btn-primary&quot;, data: &#123; disable_with: &quot;Submitting...&quot; &#125; %&gt;</div><div class="line"></div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure>
<p>存档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git commit -m &quot;replace form with simple_form bootstrap template&quot;</div></pre></td></tr></table></figure>
<h2 id="ch04加入使用者功能"><a href="#ch04加入使用者功能" class="headerlink" title="ch04加入使用者功能"></a>ch04加入使用者功能</h2><h3 id="安装devise-gem"><a href="#安装devise-gem" class="headerlink" title="安装devise gem"></a>安装devise gem</h3><p>git checkout -b ch04</p>
<p>Gemfile中加入</p>
<p> gem “devise”</p>
<p>执行：</p>
<p>bundle install</p>
<p>产生会员系统的必要文件：</p>
<p>rails g devise: install</p>
<p>rails g devise user</p>
<p>rake db:migrate</p>
<p>后重启server</p>
<p>在groups_controller.rb中“新增讨论群”必须先登入</p>
<p>加入：</p>
<p> before_action :authenticate_user!, only: [:new]</p>
<p>这样后你要访问<a href="http://localhost:3000/groups/new" target="_blank" rel="external">http://localhost:3000/groups/new</a> 时，就会出现“登入画面”阻挡。</p>
<p>git存档</p>
<p>git add .</p>
<p>git commit -m “install devise”</p>
<p>解说：</p>
<p>devise 帮我们做了什么？</p>
<ul>
<li>在这一阶段的细节，你不太需要知道他是怎么运作？（事实上也很复杂）</li>
<li>你只要知道 before_action :authenticate_user! 可以帮你做出“限制使用者必须登入”的功能。</li>
</ul>
<p>before_action 又是什么呢？</p>
<p>before_action 后面加的往往是一个 controller 内的 method，在这里 :authenticate_user! 是 devise 提供的内建功能。</p>
<ul>
<li>before_action :authenticate_user! , only: [:new]，表示“只有 new 需要登入”</li>
<li>before_action :authenticate_user! 后面不加任何东西，表示这个 controller 下的所有 action 都要登入。</li>
<li>你可以把 before_action 想像成“先过我这一关”的“拦截器”</li>
</ul>
<h3 id="让网站具有登入登出功能"><a href="#让网站具有登入登出功能" class="headerlink" title="让网站具有登入登出功能"></a>让网站具有登入登出功能</h3><p>修改_navbar.html.erb</p>
<p> app/views/common/_navbar.html.erb</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;%<span class="ruby"> <span class="keyword">if</span> !current_user </span>%&gt;</div><div class="line">  &lt;li&gt;&lt;%=<span class="ruby"> link_to(<span class="string">"注册"</span>, new_user_registration_path) </span>%&gt; &lt;/li&gt;</div><div class="line">  &lt;li&gt;&lt;%=<span class="ruby"> link_to(<span class="string">"登入"</span>, new_user_session) </span>%&gt; &lt;/li&gt;</div><div class="line">&lt;%<span class="ruby"> <span class="keyword">else</span> </span>%&gt;</div><div class="line">  &lt;li class="dropdown"&gt;</div><div class="line">    &lt;a href="#" class="dropdown-toggle" data-toggle="dropdown"&gt; Hi!, &lt;%=<span class="ruby"> current_user.email </span>%&gt;</div><div class="line">      &lt;b class="caret"&gt;&lt;/b&gt;</div><div class="line">    &lt;/a&gt;</div><div class="line">  &lt;/li&gt;</div><div class="line">&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;</div></pre></td></tr></table></figure>
<p>修改 app/assets/javascripts/application.js</p>
<p>加入 //= require bootstrap/dropdown</p>
<p>app/assets/javascripts/application.js</p>
<p>//= require bootstrap/alert</p>
<p>+ //= require bootstrap/dropdown</p>
<p>git存储</p>
<p>git add .</p>
<p>git commit -m “user can login/logout/signup”</p>
<p>解说：</p>
<p>current_user 是什么？</p>
<p>current_user 是 Devise 提供的“正在登入的当前用户”，你可以在 controller 或 view 里面使用它。</p>
<p>!current_user 又是什么</p>
<p>! 表示不等于。!current_user 表示“现在没有登入的用户”（不在登入的状态）</p>
<h3 id="让群主与使用者产生关联"><a href="#让群主与使用者产生关联" class="headerlink" title="让群主与使用者产生关联"></a>让群主与使用者产生关联</h3><p>rails g migration add_user_id_to_group</p>
<p>在db/migrate/一串数字_add_user_it_to_group中加入add_column :groups, :user_id, :integer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class AddUserIdToGroup &lt; ActiveRecord::Migration[5.0]</div><div class="line">  def change</div><div class="line">    add_column :groups, :user_id, :integer</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>为什么add_column :groups, :user_id, :integer？</p>
<p>执行</p>
<p>rake db:migrate</p>
<p>在app/models/user.rb加入has_many :groups</p>
<p>在app/models/group.rb加入belongs_to :user</p>
<p>在app/controllers/groups_controller.rb中的登入验证代码中假如create</p>
<p>在create方法代码中加入赋值：@group.user = current_user</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">create</span></span></div><div class="line">    @group = Group.new(group_params)</div><div class="line">    @group.user = current_user</div><div class="line">    <span class="keyword">if</span> @group.save</div><div class="line">      redirect_to groups_path</div><div class="line">    <span class="keyword">else</span></div><div class="line">      render <span class="symbol">:new</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>git存储</p>
<p>git add .</p>
<p>git commit -m “add user_id to group”</p>
<p>修改group列表，加上user 名字列</p>
<p>app/views/groups/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;tr&gt;</div><div class="line">    &lt;td&gt;#&lt;/td&gt;</div><div class="line">    &lt;td&gt;Title&lt;/td&gt;</div><div class="line">    &lt;td&gt;Description&lt;/td&gt;</div><div class="line">    &lt;td&gt;Creator &lt;/td&gt;</div><div class="line">  &lt;/tr&gt;</div></pre></td></tr></table></figure>
<p>app/views/groups/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;tr&gt;</div><div class="line">      &lt;td&gt;#&lt;/td&gt;</div><div class="line">      &lt;td&gt;&lt;%= link_to(group.title, group_path(group)) %&gt;&lt;/td&gt;</div><div class="line">      &lt;td&gt;&lt;%= group.description %&gt;&lt;/td&gt;</div><div class="line">      &lt;td&gt; &lt;%= group.user.email %&gt; &lt;/td&gt;</div></pre></td></tr></table></figure>
<p>做完之后，打开 <a href="http://localhost:3000/" target="_blank" rel="external">http://localhost:3000/</a> 会发现，首页怎么爆炸了。</p>
<p>别担心，这是因为我们之前创造的“群组”都是“无主”的。只要把这些“无主”的群组，通通删掉就行了。既然我们也进不去首页删群组了，我们就从 console 删吧。</p>
<p>删除所有“无主”的群组</p>
<p>执行(先执行spring stop)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails console</div></pre></td></tr></table></figure>
<p>然后输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Group.delete_all</div></pre></td></tr></table></figure>
<p>然后再打开 <a href="http://localhost:3000/" target="_blank" rel="external">http://localhost:3000/</a> 就正常了。</p>
<p>新增资料后就会显示creator的信息了</p>
<p>git存档</p>
<p>git add .</p>
<p>git commit -m “show group’s creator info”</p>
<h3 id="路人不应该可以看到“修改”“删除”按钮"><a href="#路人不应该可以看到“修改”“删除”按钮" class="headerlink" title="路人不应该可以看到“修改”“删除”按钮"></a>路人不应该可以看到“修改”“删除”按钮</h3><p>修改app/views/groups/index.html.erb</p>
<p>加入&lt;% if current_user &amp;&amp; current_user == group.user %&gt;</p>
<p>app/views/groups/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;td&gt;</div><div class="line">           &lt;% if current_user &amp;&amp; current_user == group.user %&gt;</div><div class="line">             &lt;%= link_to(&quot;Edit&quot;, edit_group_path(group), class: &quot;btn btn-sm btn-default&quot;)%&gt;</div><div class="line">             &lt;%= link_to(&quot;Delete&quot;, group_path(group),    class: &quot;btn btn-sm btn-default&quot;,</div><div class="line">                         method: :delete, data: &#123; confirm: &quot;Are you sure?&quot; &#125; )%&gt;</div><div class="line">           &lt;% end %&gt;</div><div class="line">         &lt;/td&gt;</div></pre></td></tr></table></figure>
<p>刷新首页，路人就看不到按钮了。</p>
<p>git 存档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git commit -m &quot;people can&apos;t see edit button unless he is group owner&quot;</div></pre></td></tr></table></figure>
<h3 id="路人不应该也可以直接输入网址去存取edit-update-destroy-action"><a href="#路人不应该也可以直接输入网址去存取edit-update-destroy-action" class="headerlink" title="路人不应该也可以直接输入网址去存取edit/update/destroy action"></a>路人不应该也可以直接输入网址去存取edit/update/destroy action</h3><p>除了将按钮对路人隐藏外，我们还要考虑到一个情形，假设这个路人是知道 Rails 规则的，那么他可能输入 <a href="http://localhost:3000/groups/某笔资料的ID/edit" target="_blank" rel="external">http://localhost:3000/groups/某笔资料的ID/edit</a> 网址，就直接可以编辑资料。</p>
<p>我们也要在 controller 做权限判断，滤掉这种人。</p>
<p>首先，我们先限定 edit / update / destroy 这三个操作动作，必须要是“登入”的使用者才能存取。</p>
<p>修改 app/controllers/groups_controller.rb 在 before_action :authenticate_user! 列表中，加入 :edit, :update, :destroy</p>
<p>app/controllers/groups_controller.rb</p>
<p>class GroupsController &lt; ApplicationController</p>
<pre><code>before_action :authenticate_user! , only: [:new, :create, :edit, :update, :destroy]
</code></pre><h3 id="必须要是-group-拥有人，才能进入-edit，否则会被重导至首页，并显示错误讯息。"><a href="#必须要是-group-拥有人，才能进入-edit，否则会被重导至首页，并显示错误讯息。" class="headerlink" title="必须要是 group 拥有人，才能进入 edit，否则会被重导至首页，并显示错误讯息。"></a>必须要是 group 拥有人，才能进入 edit，否则会被重导至首页，并显示错误讯息。</h3><p>修改 app/controllers/groups_controller.rb 加入权限，如果不是“创始者”去存取，会显示没有权限的错误讯息。</p>
<p>app/controllers/groups_controller.rb</p>
<p>  def edit</p>
<pre><code>@group = Group.find(params[:id])

if current_user != @group.user

  redirect_to root_path, alert: &quot;You have no permission.&quot;

end
</code></pre><p>  end</p>
<p>这样当其他人，试图输入 <a href="http://localhost:3000/groups/某笔资料的ID/edit" target="_blank" rel="external">http://localhost:3000/groups/某笔资料的ID/edit</a> 这样的网址，想要修改资料，就会被挡住。</p>
<h3 id="依样画葫芦的把“权限检查”的程式码，套用到-update-destroy-上"><a href="#依样画葫芦的把“权限检查”的程式码，套用到-update-destroy-上" class="headerlink" title="依样画葫芦的把“权限检查”的程式码，套用到 update / destroy 上"></a>依样画葫芦的把“权限检查”的程式码，套用到 update / destroy 上</h3><p>修改 app/controllers/groups_controller.rb 中的 update 与 destroy 部分。</p>
<p>不过update有用，但是destroy似乎是没有作用的。</p>
<p>git存档</p>
<p>git add .</p>
<p>git commit -m “check owner permission when access edit/update/destroy”</p>
<h3 id="制作-find-group-and-check-permission"><a href="#制作-find-group-and-check-permission" class="headerlink" title="制作 find_group_and_check_permission"></a>制作 find_group_and_check_permission</h3><p>放到private</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@group = Group.find(params[:id])</div><div class="line">if current_user != @group.user</div><div class="line">  redirect_to root_path, alert: &quot;You have no permission.&quot;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>把edit update destroy中的上面代码代替为find_group_and_check_permission</p>
<p>git 存档</p>
<p>git add .</p>
<p>git commit -m “user before_action to find_group_and_check_psermission”</p>
<h3 id="修改掉show里面的Edit按钮"><a href="#修改掉show里面的Edit按钮" class="headerlink" title="修改掉show里面的Edit按钮"></a>修改掉show里面的Edit按钮</h3><p>这样路人进入就看不到edit按钮</p>
<p>变成这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">app/views/groups/show.html.erb</div><div class="line">  &lt;div class=&quot;group&quot;&gt;</div><div class="line">    &lt;% if current_user &amp;&amp; current_user == @group.user %&gt;</div><div class="line">      &lt;%= link_to(&quot;Edit&quot;, edit_group_path(@group), class: &quot;btn btn-primary pull-right&quot;)%&gt;</div><div class="line">    &lt;% end %&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>git存档</p>
<p>git add .</p>
<p>git commit -m “add permission check on show page”</p>
<h2 id="ch05"><a href="#ch05" class="headerlink" title="ch05"></a>ch05</h2><p>建立文章架构</p>
<p>git checkout -b ch05</p>
<p>设计post的model架构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g model post content:text group_id:integer user_id:integer</div></pre></td></tr></table></figure>
<p>执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
<p>建立Group / Post / User三者之间的关系</p>
<p>Group有很多posts，Post属于Group</p>
<p>Group属于user。为什么不是Group有很多user呢？</p>
<p>User有很多posts，post属于user</p>
<p>所以在对应的文件上加上代码。自己思考。</p>
<p>git add .</p>
<p>git commit -m “add post and hook group/user relation”</p>
<p>建立Post controller</p>
<p>rails g controller posts</p>
<p>设立routing</p>
<p>修改 config/routes.rb</p>
<p>将 resources :posts 加入 resources :groups 内。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Rails.application.routes.draw do</div><div class="line">  devise_for :users</div><div class="line">  resources :groups do</div><div class="line">    resources :posts</div><div class="line">  end</div><div class="line">  root &apos;groups#index&apos;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>rake routes后你会发现，routing列表内产生了很多网址。</p>
<p>git 存档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git commit -m &quot;add posts nested route&quot;</div></pre></td></tr></table></figure>
<p>在groups#show新增“Write a post”按钮</p>
<p>修改 app/views/groups/show.html.erb</p>
<p>然后加入一行</p>
<p>app/views/groups/show.html.erb</p>
<p>  &lt;%= link_to(“Write a Post”, new_group_post_path(@group), class: “btn btn-default pull-right”)%&gt;</p>
<p>git 存档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git commit -m &quot;add post button&quot;</div></pre></td></tr></table></figure>
<p><strong>实际发表文章</strong></p>
<p>Attachment Blocks</p>
<p>目标：</p>
<ul>
<li>实际把文章发在群里面</li>
<li>使用者可以在群里面看到文章一览表</li>
</ul>
<p>步骤：</p>
<p>Step 1: 实作 new / create action</p>
<p>新增 new 与 create action 在 posts_controller</p>
<p>app/controllers/posts_controller.rb</p>
<p>class PostsController &lt; ApplicationController</p>
<p>  before_filter :authenticate_user!, :only =&gt; [:new, :create]</p>
<p>  def new</p>
<pre><code>@group = Group.find(params[:group_id])

@post = Post.new
</code></pre><p>  end</p>
<p>  def create</p>
<pre><code>@group = Group.find(params[:group_id])

@post = Post.new(post_params)

@post.group = @group

@post.user = current_user

if @post.save

  redirect_to group_path(@group)

else

  render :new

end
</code></pre><p>  end</p>
<p>  private</p>
<p>  def post_params</p>
<pre><code>params.require(:post).permit(:content)
</code></pre><p>  end</p>
<p>end</p>
<p>​    </p>
<p>Step 2. 新增 app/views/posts/new.html.erb</p>
<p>touch app/views/posts/new.html.erb</p>
<p>app/views/posts/new.html.erb</p>
<h2 class="text-center">新增文章</h2>

<div class="col-md-4 col-md-offset-4"><br><br>  &lt;%= simple_form_for [@group,@post] do |f| %&gt;<br><br>    <div class="form-group"><br><br>      &lt;%= f.input :content, input_html: { class: “form-control”} %&gt;<br><br>    </div>

<pre><code>&lt;div class=&quot;form-actions&quot;&gt;

  &lt;%= f.submit &quot;Submit&quot;, disable_with: &quot;Submiting...&quot;, class: &quot;btn btn-primary&quot;%&gt;

&lt;/div&gt;
</code></pre><p>  &lt;% end %&gt;</p>
<p></p></div><p></p>
<p>​    </p>
<p>Step 3. 修改 groups_controller 中的 show action</p>
<p>修改 app/controllers/groups_controller.rb</p>
<p>app/controllers/groups_controller.rb</p>
<p>  def show</p>
<pre><code>@group = Group.find(params[:id])

@posts = @group.posts
</code></pre><p>  end</p>
<p>​    </p>
<p>Step 4. 修改 groups/show.html.erb</p>
<p>我们要修改 app/views/groups/show.html.erb，让文章能够显示出来，在 @group.description 下，我们多加了一个表格做这件事。</p>
<p>app/views/groups/show.html.erb</p>
  <p>&lt;%= @group.description %&gt;</p>

  <table class="table"><br><br>    <thead><br><br>      <tr><br><br>        <th>文章内容</th><br><br>        <th>发表者</th><br><br>        <th>发表时间</th><br><br>      </tr><br><br>    </thead><br><br>    <tbody><br><br>      &lt;% @posts.each do |post| %&gt;<br><br>        <tr><br><br>          <td>&lt;%= post.content %&gt;</td><br><br>          <td>&lt;%= post.user.email %&gt;</td><br><br>          <td>&lt;%= post.created_at %&gt;</td><br><br>        </tr><br><br>      &lt;% end %&gt;<br><br>    </tbody><br><br>  </table>

<p>​    </p>
<p>新增几笔文章试看看！</p>
<p>Step 5: 对 Post 加上 validation</p>
<p>这时候我们发现，刚刚有文章不小心没填内容，就发出去变成空的。</p>
<p>为了防止这样的情形，我们还是要限制 post 的 content 要是为空，就不得送出。</p>
<p>修改 app/models/post.rb 加入 validates :content, presence: true</p>
<p>app/models/post.rb</p>
<p>class Post &lt; ApplicationRecord</p>
<p>  belongs_to :user</p>
<p>  belongs_to :group</p>
<p>  validates :content, presence: true</p>
<p>end</p>
<p>​    </p>
<p>之后要是再有使用者，送出空的内容，就会被挡下来。</p>
<p>Step 6. git 存档</p>
<p>git add .</p>
<p>git commit -m “implement post create function”</p>
<p>​    </p>
<p>解说</p>
<p>params[:group_id] 从哪来的？</p>
<p>这里来的。</p>
<p><strong>文章应该按照发表时间倒序排列</strong></p>
<p>Attachment Blocks</p>
<p>目标</p>
<ul>
<li>在文章列表上，应该让文章按照发表时间“倒序”排列，我们应该让最近发表的文章在“最上面”。</li>
</ul>
<p>步骤</p>
<p>Step 1. 修改 groups_controller</p>
<p>修改 app/controllers/groups_controller.rb 的 show 加入一行 @posts = @group.posts.order(“created_at DESC”)</p>
<p>app/controllers/groups_controller.rb</p>
<p>  def show</p>
<pre><code>@group = Group.find(params[:id])

@posts = @group.posts.order(&quot;created_at DESC&quot;)
</code></pre><p>  end</p>
<p>​    </p>
<p>重新刷新，看板列表就会变成，按照发表时间“倒序”排列</p>
<p>Step 2. git 储存</p>
<p>git add .</p>
<p>git commit -m “add order by created_at to group’s post”</p>
<p>​    </p>
<p>Step 3. 使用 scope 替代直接 order</p>
<p>app/controllers/groups_controller.rb</p>
<p>  def show</p>
<pre><code>@group = Group.find(params[:id])

@posts = @group.posts.order(&quot;created_at DESC&quot;)
</code></pre><p>  end</p>
<p>​    </p>
<p>这里的 order(“created_at DESC”) 是“程式语法”，但不是“功能叙述”。我们作为旁观者，只能猜测这是要按照“最近的时序排列”。</p>
<p>如果能改成 @groups.posts.recent 可能在维护性上更直观。</p>
<p>这里我们还可以用 Rails 里面的一个内建 API scope 让程式码更直观一些。 scope 可以用来包装一些查询式，如果我们这里想要让最后的程式码变成 @groups.posts.recent 的话，作法如下：</p>
<p>修改 app/models/post.rb，加入一行 scope :recent, -&gt; { order(“created_at DESC”)}</p>
<p>app/models/posts.rb</p>
<p>class Post &lt; ApplicationRecord</p>
<h1 id="…-略"><a href="#…-略" class="headerlink" title="… 略"></a>… 略</h1><p>  scope :recent, -&gt; { order(“created_at DESC”)}</p>
<p>end</p>
<p>​    </p>
<p>然后修改 app/controllers/groups_controller.rb 中的 show，变成</p>
<p>app/controllers/groups_controller.rb</p>
<p>  def show</p>
<pre><code>@group = Group.find(params[:id])

@posts = @group.posts.recent
</code></pre><p>  end</p>
<p>​    </p>
<p>这样就可以了。</p>
<p>Step 2. git 储存</p>
<p>git add .</p>
<p>git commit -m “using scope to write order by created_at to group’s post”</p>
<p>​    </p>
<p>解说</p>
<p>order(“created_at DESC”) 是什么？</p>
<p>实际上呢，Model 里面的所有调用语法，看起来是“Ruby 语法”，实际上是 Rails 帮我们“翻译”成为了资料库语法。（这一套叫 ActiveRecord 框架）</p>
<p>如果有兴趣的话，Rails 的 Log 都有显示的。</p>
<p>比如说：</p>
<p>Post.all 真正的资料库语法是 SELECT “posts”.* FROM “posts”</p>
<p>@group.posts.order(“created_at DESC”) 是 SELECT “posts”.* FROM “posts” WHERE “posts”.”group_id” = ? ORDER BY created_at DESC</p>
<p>因为资料库语法也是个“巨坑”，Rails 开发的目的，在于希望程式设计师专注于“产品”的逻辑设计，而花上少一点时间去纠缠非常底层的细节。</p>
<p>在刚开始学习过程中，其实你是不太需要去纠结资料库的语法的，大部份你想要捞的资料，ActiveRecord 都能帮你搞定，而且可以“形容”的非常“口语”。</p>
<p>scope 又是什么呢？</p>
<p>你可以想像成，拿来包装“常用 query”的方法。理解到这里就可以了。</p>
<p>更多 scope 的用法：<a href="http://guides.rubyonrails.org/active_record_querying.html" target="_blank" rel="external">http://guides.rubyonrails.org/active_record_querying.html</a></p>
<p><strong>加入文章分页功能</strong></p>
<p>Attachment Blocks</p>
<p>目标</p>
<ul>
<li>为文章列表加入分页功能。</li>
<li>一页 5 篇文章。</li>
</ul>
<p>步骤</p>
<p>Step 1: 安装 will_paginate</p>
<p>Rails 社群内有很多“分页”功能的 gem 可以办到这件事，其中最热门的 gem 叫 will_paginate，使用这些 gem ，一下子就会把功能做完了。</p>
<p>修改 Gemfile，加入 will_paginate</p>
<p>gem “will_paginate”</p>
<p>Gem</p>
<p>gem “will_paginate”</p>
<p>​    </p>
<p>然后执行</p>
<p>bundle install</p>
<p>​    </p>
<p>然后重开 rails server</p>
<p>Step 2: 修改 groups_controller</p>
<p>修改 app/controllers/groups_controller.rb 中的 show</p>
<p>加入分页程式码，变成</p>
<p>app/controllers/groups_controller.rb</p>
<p>  def show</p>
<pre><code>@group = Group.find(params[:id])

@posts = @group.posts.recent.paginate(:page =&gt; params[:page], :per_page =&gt; 5)
</code></pre><p>  end</p>
<p>​    </p>
<p>Step 3: 修改 groups/show.html.erb</p>
<p>修改 app/views/groups/show.html.erb 然后在最下面  下加入 &lt;%= will_paginate @posts %&gt;</p>
<p>app/views/groups/show.html.erb</p>
<p>  </p>
<p></p>
<div class="text-center"><br><br>  &lt;%= will_paginate @posts %&gt;<br><br></div>

<p>​    </p>
<p>如果你的群组内，超过 5 篇文章（现在就去新增！！），就可以看到分页功能出现了。</p>
<p>Step 4: git 储存</p>
<p>git add .</p>
<p>git commit -m “implement posts pagination with will_paginate”</p>
<p>​    </p>
<p>解说：</p>
<p>要去哪里才能知道，我想要的功能要用什么 gem 呢？</p>
<p>*各种功能的gem一览： <a href="https://www.ruby-toolbox.com/" target="_blank" rel="external">RubyToolbox</a></p>
<h2 id="ch06"><a href="#ch06" class="headerlink" title="ch06"></a>ch06</h2><p><strong>建立“群成员”资料表</strong></p>
<p>Attachment Blocks</p>
<p>目标</p>
<ul>
<li>建立群成员的关系表</li>
</ul>
<p>步骤</p>
<p>Step 0. git checkout -b ch06</p>
<p>因为我们现在要实作第六章的内容，新增一个 branch 把实作内容集中在 ch06 是比较合理的。将来回顾就可以比较清楚 在 ch06 我们做了哪一些练习。</p>
<p>git checkout -b ch06</p>
<p>​        </p>
<p>Step 1: 建立 GroupRelationship</p>
<p>我们在这里要建立一个新的 model 叫 GroupRelationship。这个资料表里面只有两个栏位：</p>
<ul>
<li>group_id ( integer )</li>
<li>user_id ( integer)</li>
</ul>
<p>记录了“谁”参加了“哪个群组”。</p>
<p>输入</p>
<p>rails g model group_relationship group_id:integer user_id:integer</p>
<p>执行</p>
<p>rake db:migrate</p>
<p>Step 2: 设定 Group 与 User 之间的关系 ( 使用者参与的所有群）</p>
<p>在这之前，在 User model 已经有一行：has_many :groups</p>
<p>app/models/user.rb</p>
<p>class User &lt; ApplicationRecord</p>
<p># .. 略</p>
<p>  has_many :groups</p>
<p># .. 略</p>
<p>end</p>
<p>​        </p>
<p>user.groups 会捞出这个使用者“创造过的所有群”。那我们要如何撰写 “参与的所有群”呢？</p>
<p>首先，修改 app/models/user.rb 加入以下两行</p>
<p>app/models/user.rb</p>
<p>class User &lt; ApplicationRecord</p>
<p># .. 略</p>
<pre><code>has_many :group_relationships
</code></pre><p>  has_many :participated_groups, :through =&gt; :group_relationships, :source =&gt; :group</p>
<p>end</p>
<p>​        </p>
<p>然后修改 app/models/group_relationship.rb，加入这两行</p>
<p>app/models/group_relationship.rb</p>
<p>class GroupRelationship &lt; ApplicationRecord</p>
<p>  belongs_to :group</p>
<p>  belongs_to :user</p>
<p>end</p>
<p>​        </p>
<p>这样当捞 user.partcipated_groups 时，就会捞出“参与的所有群”。</p>
<p>Step 3: 设定 Group 与 User 之间的关系 ( 群组内的所有会员 ）</p>
<p>修改 app/models/group.rb，加入这两行</p>
<p>app/models/group.rb</p>
<p>class Group &lt; ApplicationRecord</p>
<h1 id="…-略-1"><a href="#…-略-1" class="headerlink" title="… 略"></a>… 略</h1><p>  has_many :group_relationships</p>
<p>  has_many :members, through: :group_relationships, source: :user</p>
<p>end</p>
<p>​        </p>
<p>Step 4: git 储存</p>
<p>git add .</p>
<p>git commit -m “implement group relation”</p>
<p>​        </p>
<p>Step 5: 动手测看看</p>
<p>打开 rails console</p>
<p>输入</p>
<p> u = User.first</p>
<p> g = Group.first</p>
<p> g.members &lt;&lt; u</p>
<p> g.members</p>
<p> u.participated_groups</p>
<p>​        </p>
<p>看看会出现什么结果。</p>
<p>解说：</p>
<p>可以花时间解释一下什么是 has_many :through 吗？</p>
<p>has_many :through</p>
<p>has_many :through主要是在建立多对多关联资料库的时候使用。</p>
<p>例如一个“球队”可以有很多“球员”，一个“球员”可以参加很多“球队”，这个就是多对多关系。</p>
<p>在这里球员跟球队都是一个 Model，要建立多对多关系时我们会需要第三个 Model扮演连接的桥梁。</p>
<p>第三个 Model 就是“体育协会”，负责登记每个球员所属的球队以及球队目前的成员。如此一来我们就可以从体育协会得知每个球队和球员的状况（所以叫作“through”）。</p>
<p>所以“球员”throuth“体育协会”has_many“球队”，举例：</p>
<p><strong>models/player.rb</strong></p>
<p>class Player &lt; ActiveRecord::Base</p>
<h1 id="先告诉model我们在体育协会有很多笔资料"><a href="#先告诉model我们在体育协会有很多笔资料" class="headerlink" title="先告诉model我们在体育协会有很多笔资料"></a>先告诉model我们在体育协会有很多笔资料</h1><pre><code>has_many :sports_associations
</code></pre><h1 id="这些资料是要拿来判断这个球员有参与多少球队"><a href="#这些资料是要拿来判断这个球员有参与多少球队" class="headerlink" title="这些资料是要拿来判断这个球员有参与多少球队"></a>这些资料是要拿来判断这个球员有参与多少球队</h1><pre><code>has_many :teams, :through =&gt; :sports_associations
</code></pre><p>end</p>
<p>​        </p>
<p><strong>models/team.rb</strong></p>
<p>class Team &lt; ActiveRecord::Base</p>
<pre><code>has_many :sports_associations

has_many :players, :through =&gt; :sports_associations
</code></pre><p>end</p>
<p>​        </p>
<p><strong>models/sports_associations.rb</strong></p>
<p>class SportsAssociations &lt; ActiveRecord::Base</p>
<h1 id="体育协会要对球员和球队负责，所以体育球队belongs-to球员和球队"><a href="#体育协会要对球员和球队负责，所以体育球队belongs-to球员和球队" class="headerlink" title="体育协会要对球员和球队负责，所以体育球队belongs_to球员和球队"></a>体育协会要对球员和球队负责，所以体育球队belongs_to球员和球队</h1><pre><code>belongs_to :team

belongs_to :player
</code></pre><p>end</p>
<p><strong>在群组里面判断“是否群组成员”</strong></p>
<p>Attachment Blocks</p>
<p>实作目标</p>
<ul>
<li>会员要可以在社团里面看到自己“是否群组成员”</li>
</ul>
<p>步骤</p>
<p>Step 1. 在 user model 内实作“是否为成员一分子”的判断式 is_member_of?(group)</p>
<p>让我们修改 app/models/user.rb 加入这一段 is_member_of?(group)</p>
<p>app/models/user.rb</p>
<p>  def is_member_of?(group)</p>
<pre><code>participated_groups.include?(group)
</code></pre><p>  end</p>
<p>​    </p>
<p>然后“重开”rails console</p>
<p>输入</p>
<p>u = User.first</p>
<p>g = Group.first</p>
<p>u.is_member_of?(g)</p>
<p>​    </p>
<p>结果会是这样：</p>
<p>我们等一下将会使用 is_member_of?(group)来判断“这个使用者是否属于该群组”</p>
<p>Step 2. 修改 groups/show.html.erb</p>
<p>我们在 app/views/groups/show.html.erb 加入这一段</p>
<p>app/views/groups/show.html.erb</p>
<p><span class="pull-right"></span></p>
<p>  &lt;% if current_user &amp;&amp; current_user.is_member_of?(@group) %&gt;</p>
<pre><code>&lt;label class=&quot;label label-success&quot;&gt; 群组成员 &lt;/label&gt;
</code></pre><p>  &lt;% else %&gt;</p>
<pre><code>&lt;label class=&quot;label label-warning&quot;&gt; 不是群组成员 &lt;/label&gt;
</code></pre><p>  &lt;% end %&gt;</p>
<p></p>
<p>​    </p>
<p>你应该只会看到这两种结果</p>
<p>Step 3. git 存档</p>
<p>git add .</p>
<p>git commit -m “implement is_member_of?(group)”</p>
<p>​    </p>
<p>解说</p>
<p>is_member_of?(group) 为什么这一段要放在 User 的 model 里？</p>
<ul>
<li>因为它是要被 user 所使用的判断式</li>
</ul>
<p>“?”问号在这里有任何意义吗？</p>
<p>你可以暂时把它视为 “method 名字的一部分”，“暂时”没有意义。</p>
<p><strong>“加入群组”或“退出群组”</strong></p>
<p>Attachment Blocks</p>
<p>目标</p>
<ul>
<li>实作 model 层 “加入群组”</li>
<li>实作 model 层“退出群组”</li>
</ul>
<p>步骤</p>
<p>步骤 1:</p>
<p>app/models/user.rb</p>
<p>  def join!(group)</p>
<pre><code>participated_groups &lt;&lt; group
</code></pre><p>  end</p>
<p>  def quit!(group)</p>
<pre><code>participated_groups.delete(group)
</code></pre><p>  end</p>
<p>​    </p>
<p>打开 rails console</p>
<p>输入</p>
<p>u = User.first</p>
<p>g = Group.first</p>
<p>u.join!(g)</p>
<p>u.is_member_of?(g)</p>
<p>u.quit!(g)</p>
<p>u.is_member_of?(g)</p>
<p>​    </p>
<p>步骤 2:</p>
<p>git add .</p>
<p>git commit -m “join or quit group”</p>
<p>​    </p>
<p>解说</p>
<p>“!”惊叹号在这里有任何意义吗？</p>
<p>你可以暂时把它视为 “method 名字的一部分”，“暂时”没有意义。</p>
<p><strong>实际操作“加入群组”或“退出群组”</strong></p>
<p>Attachment Blocks</p>
<p>步骤</p>
<p>Step 1:</p>
<p>app/controllers/groups_controller.rb</p>
<ul>
<li>def join</li>
</ul>
<p>+   @group = Group.find(params[:id])</p>
<p>+  </p>
<ul>
<li>if !current_user.is_member_of?(@group)</li>
<li>current_user.join!(@group)</li>
<li>flash[:notice] = “加入本讨论版成功！”</li>
<li>else</li>
<li>flash[:warning] = “你已经是本讨论版成员了！”</li>
<li>end</li>
</ul>
<p>+  </p>
<ul>
<li>redirect_to group_path(@group)</li>
<li>end</li>
</ul>
<p>+  </p>
<ul>
<li>def quit</li>
<li>@group = Group.find(params[:id])</li>
</ul>
<p>+  </p>
<ul>
<li>if current_user.is_member_of?(@group)</li>
<li>current_user.quit!(@group)</li>
<li>flash[:alert] = “已退出本讨论版！”</li>
<li>else</li>
<li>flash[:warning] = “你不是本讨论版成员，怎么退出 XD”</li>
<li>end</li>
</ul>
<p>+  </p>
<ul>
<li>redirect_to group_path(@group)</li>
<li><p>end</p>
<p>  private</p>
</li>
</ul>
<p>​    </p>
<p>Step 2:</p>
<p>config/routes.rb</p>
<p>resources :groups do</p>
<ul>
<li>member do</li>
<li>post :join</li>
<li>post :quit</li>
<li><p>end</p>
<p>  resources :posts</p>
<p>end</p>
</li>
</ul>
<p>​    </p>
<p>Step 3:</p>
<p>将这个档案修改成这样：</p>
<p>app/views/groups/show.html.erb</p>
<p><span class="pull-right"></span></p>
<p>  &lt;% if current_user &amp;&amp; current_user.is_member_of?(@group) %&gt;</p>
<pre><code>&lt;label class=&quot;label label-success&quot;&gt; 群组成员 &lt;/label&gt;

&lt;%= link_to(&quot;Quit Group&quot;, quit_group_path(@group), method: :post, class: &quot;btn btn-default&quot;) %&gt;
</code></pre><p>  &lt;% else %&gt;</p>
<pre><code>&lt;label class=&quot;label label-warning&quot;&gt; 不是群组成员 &lt;/label&gt;

&lt;%= link_to(&quot;Join Group&quot;, join_group_path(@group), method: :post, class: &quot;btn btn-default&quot;) %&gt;
</code></pre><p>  &lt;% end %&gt;</p>
<p></p>
<p>​    </p>
<p>Step 4:</p>
<p>git add .</p>
<p>git commit -m “join &amp; quit group action”</p>
<p>​    </p>
<p>解说：</p>
<p>member 是什么？它的规则是什么？</p>
<p>执行 rake routes，你会看到它产生的规则是 join_group_path(@group) ，“单数”。member 是单数。</p>
<p>还有一个东西，叫 collection，假设我们要做一个热门文章吧，叫做 hot，意思是“热门的文章”“们”，这时候我们就会用 collection。</p>
<p>再执行 rake routes</p>
<p>在这边你只要先“背”起来：</p>
<ul>
<li>member （成员）是“单数”，不加 s</li>
<li>collection （集合）是“复数”，加 s</li>
</ul>
<p><strong>User 在建立 group 后自动成为 group 的一员</strong></p>
<p>Attachment Blocks</p>
<p>目标</p>
<p>当你创办了 group ，却还要手动再加入这个 group 不会很怪吗？ XD</p>
<p>所以在这个步骤我们让 User 在建立 group 后自动成为 group 的一员</p>
<p>步骤</p>
<p>Step 1 :</p>
<p>app/controllers/groups_controller.rb</p>
<p>  def create</p>
<pre><code>@group = Group.new(group_params)

@group.user = current_user

if @group.save
</code></pre><p>+     current_user.join!(@group)</p>
<pre><code>  redirect_to groups_path

else

  render :new

end
</code></pre><p>  end</p>
<p>​    </p>
<p>Step 2:</p>
<p>git add .</p>
<p>git commit -m “when created a group, join it automatically”</p>
<h2 id="Ch07-使用者可以在“自己的后台”看过曾经发表的文章、以及创立的社团"><a href="#Ch07-使用者可以在“自己的后台”看过曾经发表的文章、以及创立的社团" class="headerlink" title="Ch07 使用者可以在“自己的后台”看过曾经发表的文章、以及创立的社团"></a>Ch07 使用者可以在“自己的后台”看过曾经发表的文章、以及创立的社团</h2><p><strong>可以看到自己参与的所有群组</strong></p>
<p>Attachment Blocks</p>
<p>目标</p>
<ul>
<li>使用者在下拉选单内，可以看到 “My Groups”</li>
<li>使用者点选 “My Groups” 可以看到自己参与的所有群组</li>
</ul>
<p>步骤</p>
<p>Step 0. git checkout -b ch07</p>
<p>因为我们现在要实作第七章的内容，新增一个 branch 把实作内容集中在 ch07 是比较合理的。将来回顾就可以比较清楚 在 ch07 我们做了哪一些练习。</p>
<p>git checkout -b ch07</p>
<p>​    </p>
<p>Step 1: 产生 account 的 namespace 下的 groups_controller</p>
<p>执行</p>
<p>rails g controller account/groups</p>
<p>​    </p>
<p>Step 2. 修改 routing</p>
<p>修改 config/routes.rb 加入：</p>
<p>config/routes.rb</p>
<p>  namespace :account do</p>
<pre><code>resources :groups
</code></pre><p>  end</p>
<p>​    </p>
<p>Step 3: 修改下拉选项</p>
<p>然后修改 app/views/common/_navbar.html.erb</p>
<p>加入多一个“下拉选单选项”：</p>
<p>app/views/common/_navbar.html.erb</p>
   <ul class="dropdown-menu"><br><br>       <li> &lt;%= link_to(“My Groups”, account_groups_path) %&gt;</li><br><br>       <li class="divider"> </li><br><br>       <li> &lt;%= link_to(“登出”, destroy_user_session_path, method: :delete) %&gt; </li><br><br>   </ul>

<p>​    </p>
<p>成果就会长这样：</p>
<p>Step 4. 建立 account/groups_controller.rb 下的 index action</p>
<p>记得要加入： before_action :authenticate_user!，限制必须要得登入使用者，才能看。</p>
<p>app/controllers/account/groups_controller.rb</p>
<p>class Account::GroupsController &lt; ApplicationController</p>
<p>  before_action :authenticate_user!</p>
<p>  def index</p>
<pre><code>@groups = current_user.participated_groups
</code></pre><p>  end</p>
<p>end</p>
<p>​    </p>
<p>Step 5. 新增 “参与群组一览表”</p>
<p>touch app/views/account/groups/index.html.erb</p>
<p>app/views/account/groups/index.html.erb</p>
<div class="col-md-12"><br><br>  <h2 class="text-center"> 我加入的讨论版 </h2><br><br>  <table class="table"><br><br>    <thead><br><br>      <tr><br><br>        <th> # </th><br><br>        <th> Title </th><br><br>        <th> Description </th><br><br>        <th> Post Count </th><br><br>        <th> Last Update </th><br><br>      </tr><br><br>    </thead><br><br>    <tbody><br><br>      &lt;% @groups.each do |group| %&gt;<br><br>        <tr><br><br>          <td> # </td><br><br>          <td> &lt;%= link_to(group.title, group_path(group)) %&gt; </td><br><br>          <td> &lt;%= group.description %&gt; </td><br><br>          <td> &lt;%= group.posts.count %&gt; </td><br><br>          <td> &lt;%= group.updated_at %&gt; </td><br><br>        </tr><br><br>      &lt;% end %&gt;<br><br>    </tbody><br><br>  </table><br><br></div>

<p>​    </p>
<p>成果：</p>
<p>Step 6: git 储存</p>
<p>git add .</p>
<p>git commit -m “implement my groups”</p>
<p>​    </p>
<p>解说</p>
<p>namespace 是什么？</p>
<ul>
<li>我们尴尬的发现，要做个人后台时，却发现 groups 这个名字已被人用走，但我们却想做出 /account/groups 这样的网址。</li>
<li>namespace 就是“命名空间”，你可以想成因为北京有很多个叫“梁朝伟”的人，所以要分成“三里屯梁朝伟”、“国贸梁朝伟”。</li>
</ul>
<p>config/routes.rb</p>
<p>  namespace :account do</p>
<pre><code>resources :groups
</code></pre><p>  end</p>
<p>​    </p>
<p>会生成以下这样的 routing</p>
<p><strong>可以看到自己发表的所有文章</strong></p>
<p>Attachment Blocks</p>
<p>目标</p>
<ul>
<li>使用者在下拉选单内，可以看到 “My Posts”</li>
<li>使用者点选 “My Posts” 可以看到自己发表的所有文章</li>
</ul>
<p>步骤</p>
<p>Step 1: 产生 account 的 namespace 下的 posts_controller</p>
<p>执行</p>
<p>rails g controller account/posts</p>
<p>​    </p>
<p>Step 2. 建立 account/posts_controller.rb 下的 index action</p>
<p>加入： before_action :authenticate_user!，限制必须要得登入使用者，才能看。</p>
<p>app/controllers/account/posts_controller.rb</p>
<p>class Account::PostsController &lt; ApplicationController</p>
<p>  before_action :authenticate_user!</p>
<p>  def index</p>
<pre><code>@posts = current_user.posts
</code></pre><p>  end</p>
<p>end</p>
<p>​    </p>
<p>Step 3. 修改 routing</p>
<p>修改 config/routes.rb 加入：</p>
<p>config/routes.rb</p>
<p>  namespace :account do</p>
<pre><code>resources :groups

resources :posts
</code></pre><p>  end</p>
<p>​    </p>
<p>Step 4: 修改下拉选项</p>
<p>然后修改 app/views/common/_navbar.html.erb</p>
<p>加入多一个“下拉选单选项”：</p>
<p>app/views/common/_navbar.html.erb</p>
<pre><code>&lt;ul class=&quot;dropdown-menu&quot;&gt;

     &lt;li&gt; &lt;%= link_to(&quot;My Groups&quot;, account_groups_path) %&gt;&lt;/li&gt;

     &lt;li&gt; &lt;%= link_to(&quot;My Posts&quot;, account_posts_path) %&gt;&lt;/li&gt; 

     &lt;li class=&quot;divider&quot;&gt; &lt;/li&gt;

     &lt;li&gt; &lt;%= link_to(&quot;登出&quot;, destroy_user_session_path, method: :delete) %&gt; &lt;/li&gt;

&lt;/ul&gt;
</code></pre><p>​    </p>
<p>成果就会长这样：</p>
<p>Step 5. 新增 “发表文章一览表”</p>
<p>touch app/views/account/posts/index.html.erb</p>
<p>app/views/account/posts/index.html.erb</p>
<div class="col-md-12"><br><br>  <h2 class="text-center"> 我发表过的文章 </h2><br><br>  <table class="table"><br><br>    <thead><br><br>      <tr><br><br>        <th> Content </th><br><br>        <th> Group Name </th><br><br>        <th> Last Update </th><br><br>        <th colspan="2"></th><br><br>      </tr><br><br>    </thead><br><br>    <tbody><br><br>      &lt;% @posts.each do |post| %&gt;<br><br>        <tr><br><br>          <td> &lt;%= post.content %&gt; </td><br><br>          <td> &lt;%= post.group.title %&gt; </td><br><br>          <td> &lt;%= post.updated_at %&gt; </td><br><br>          <td> &lt;%= link_to(‘Edit’, edit_group_post_path(post.group, post), class: “btn btn-default btn-xs”) %&gt;</td><br><br>          <td> &lt;%= link_to(‘Delete’, group_post_path(post.group, post), method: :delete, data: { confirm: “Are you sure?” }, class: “btn btn-default btn-xs”) %&gt;</td><br><br>        </tr><br><br>      &lt;% end %&gt;<br><br>    </tbody><br><br>  </table><br><br></div>

<p>​    </p>
<p>成果：</p>
<p>Step 6: git 储存</p>
<p>git add .</p>
<p>git commit -m “implement my post”</p>
<p>​    </p>
<p>额外作业：</p>
<p>（这次没有解答）</p>
<p>练习自己实作“编辑”和“删除”按钮这两个功能！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/28/Rails-的-CRUD-与-RESTful/" itemprop="url">
                  Rails 的 CRUD 与 RESTful
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-28T23:33:56+08:00" content="2016-11-28">
              2016-11-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/全栈工程师/" itemprop="url" rel="index">
                    <span itemprop="name">全栈工程师</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/28/Rails-的-CRUD-与-RESTful/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/11/28/Rails-的-CRUD-与-RESTful/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>HTTP 请求( Request）与 HTTP 动词 ( Verb）</p>
<p>一般网页的运作原理是这样的：</p>
<ol>
<li>使用者在浏览器输入了某个网址，点击了某个连结。这都叫发出 HTTP 请求 ( Request）。</li>
<li>而浏览器回应之后：产生页面，或者是重新导向。这都叫 HTTP 回应（ Response）。</li>
</ol>
<p>一般来说，使用者最常使用的是两种类型 / 动作 ( Verb )的请求： GET 与 POST。</p>
<ul>
<li>GET ：输入网址，点击某些网址。这都是 GET。</li>
<li>POST：送出表单。这叫做 POST</li>
</ul>
<p>RESTful 的基础概念</p>
<p>因为 CRUD 是常见的操作行为，但是大家实作的方式、与网址设计方式不一样。造成很多维护上的困扰。</p>
<p>后来就有人发明 RESTful 这个概念，希望用 HTTP 的动作 ( Verb）一起去封装 CRUD 的行为。所以又多加了两个动作：</p>
<ul>
<li>PUT : 更新 ( update )</li>
<li>DELETE : 删除 ( delete）</li>
</ul>
<p>而 Rails 的 Routing 也是依循这样的理念去设计。</p>
<p>Rails 的基础 RESTful概念</p>
<p>由于RESTful是个新手不容易一下子理解的概念，号称学 Ruby on Rails 初期最大障碍。</p>
<p>在本篇尽量用浅显易懂的方式解释。如果看不懂也没关系，用背的！！</p>
<p>一定要背起来！</p>
<p>以下例子以 第三章， 做出 CRUD 功能的讨论版来解释：</p>
<ul>
<li>讨论版这个功能的名称： groups。Restful 的概念里面叫做 resources，“一组资源”。</li>
</ul>
<p>为了要控制它的运作，我们会创建一个新的 Controller档案 叫做 groups_controller.rb</p>
<p>HTTP Verb 有四种：</p>
<ul>
<li>新增 (create，使用 POST )</li>
<li>读取 (read，使用 GET )</li>
<li>更新 (update，使用 PUT )</li>
<li>删除 (destroy，使用 DELETE)</li>
</ul>
<p>在这组 controller 当中，我们会实作 7 个 Action ，4 张页面。</p>
<ul>
<li>首页( index )：用来列出所有的讨论版，可以选择各个单版 （使用 GET )</li>
<li>各个讨论版专属页面(show)：显示讨论版版名跟简介 (使用 GET )</li>
<li>新增页面(new)：里面会有表单，填完以后可以送出 (使用 GET )</li>
<li>产生资料（create) ：new 送出来的表单到 create 这个 action，新增一笔资料 ( 使用 POST )</li>
<li>修改页面(edit)：里面会有表单呈现现有资料来，填完资料后可以送出 (使用 GET )</li>
<li>更新资料（update)：edit 送出来的表单可以到 update 这个 action，更新该笔资料 (使用 PUT )</li>
<li>删除资料：送出删除请求，删除该笔资料（使用 DELETE）</li>
</ul>
<p>这七个 action ，是每个CRUD功能里最基本的动作。只要我们在 controller.rb 里定义 (def) 好这七个方法当作动作 (action)。其他的部分 Rails 就会帮我们处理了。</p>
<p>像是设定 Routing (路由) 只需要简单一行:</p>
<p>config/routes.rb</p>
<p>  resources :groups</p>
<p>​    </p>
<p>这样不管浏览器端跑来什么样的请求 (request) ，Routing都会聪明地帮我们导向正确的 action 去运作后续流程。</p>
<p>网址对应关系</p>
<p>对于网址跟对应的Action与页面来说</p>
<ul>
<li>/groups/ 一定就是 index，首页，对应Routes路径： groups_path</li>
<li>/groups/123 一定就是 show，名字为123的讨论版个版页面，对应Routes路径： group_path(123)</li>
<li>/groups/123/edit 一定就是 edit，修改讨论版123的表单页面，对应Routes路径：edit_group_path(123)</li>
<li>/groups/new 一定就是 new，新增讨论版的表单页面，对应Routes路径(或称为helper)：new_group_path 总结</li>
</ul>
<p>所以制作一个 RESTful 风格的讨论版，我们仅需在Routes设定一行程式即可</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/27/Intro-to-Rails-Rails-入门详解/" itemprop="url">
                  Intro to Rails-Rails 入门详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-27T18:36:39+08:00" content="2016-11-27">
              2016-11-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/全栈工程师/" itemprop="url" rel="index">
                    <span itemprop="name">全栈工程师</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/27/Intro-to-Rails-Rails-入门详解/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/11/27/Intro-to-Rails-Rails-入门详解/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>写的这篇Intro to Rails入门详解，希望能对刚入门的人有点借鉴意义，也欢迎随时跟我交流，谢谢。</p>
<p>Table of Content</p>
<p>学习目标</p>
<p>实践</p>
<p>Step 1：在Macbook上建一个应用程序（Application）</p>
<p>Step 2：把项目加进git 数据仓库(Repo)</p>
<p>Step 3：本地执行本项目</p>
<p>Step 4：创建一个Migration</p>
<pre><code>4.1 知识点解释

    知识点一：migration &amp; rake

    知识点二：scaffolding
</code></pre><p>Step 5：使用scaffolding进行CRUD</p>
<pre><code>5. 1知识点解释

    知识点一：@topics

    知识点二：edit_topic_path(topic) &amp; new_topic_path

5.2 知识点解释

    知识点一：@topic从哪来？

    知识点二：edit_topic_path(@topic)

    知识点三：topics_path

5.3 知识点解释

    知识点一：render &apos;form&apos;, topic: @topic

5.4 知识点解释
</code></pre><p>​        知识点一：form_for</p>
<pre><code>5.5 进一步研究

5.6 余留问题
</code></pre><p>Step 6：设置默认页面</p>
<p>Step 7：对文章做投票</p>
<p>Step 8：把votes和topics连在一起</p>
<pre><code>8.1 知识点解释

    知识点一： has_many :votes, dependent: :destroy
</code></pre><p>Step 9：让我们可以投票</p>
<pre><code>9.1 知识点解释

    知识点一：upvote方法

9.2 知识点解释

    知识点一：member do post &apos;upvote&apos;

9.3 知识点解释

    知识点一：pluralize(topic.votes.count, &quot;vote&quot;)

    知识点二：button_to &apos;+1&apos;, upvote_topic_path(topic), method: :post

    知识点三：method: :post
</code></pre><p>参考资料</p>
<h1 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h1><ol>
<li>以intro to rails为素材，学习Intro to Rails，实现全栈工程师之路的入门</li>
<li>完全理解程序中的每个环节，刨根究底地寻找资源了解细节，达到完全掌握的目的</li>
<li>同时锻炼自己“只字不差地阅读”的能力</li>
</ol>
<h1 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h1><p>Intro to rails案例是在下面地址中<a href="http://docs.railsbridge.org/intro-to-rails/" target="_blank" rel="external">http://docs.railsbridge.org/intro-to-rails/</a>，接下来我们就一步一步来实现和解释。</p>
<h2 id="Step-1：在Macbook上建一个应用程序（Application）"><a href="#Step-1：在Macbook上建一个应用程序（Application）" class="headerlink" title="Step 1：在Macbook上建一个应用程序（Application）"></a>Step 1：在Macbook上建一个应用程序（Application）</h2><p>创建一个目录叫做railsbridge:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir railsbridge</div></pre></td></tr></table></figure>
<p>切换到该目录下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd railsbridge</div></pre></td></tr></table></figure>
<p>在控制台上敲打下面命令用来创建一个suggestotron项目：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails new suggestotron</div></pre></td></tr></table></figure>
<p>如果之前创建过了，可以通过以下命令给删除掉：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm –rf suggestotron</div></pre></td></tr></table></figure>
<p>Note: 关于更多怎么使用command命令可以参考<a href="http://man.linuxde.net/rm" target="_blank" rel="external">http://man.linuxde.net/rm</a></p>
<p>这样就创建了一个项目（project）叫做suggestotron。</p>
<p>同样地，切换到suggestotron:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd suggestotron</div></pre></td></tr></table></figure>
<p><strong>干货提醒：以上用到的所有命令都要背诵下来。没有记住的同学请返回去再记一遍。</strong></p>
<p>接下来，用文本工具（text editor如Sublime）打开整个项目,打开后目录如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">^suggestotron</div><div class="line"> &gt;.bundle</div><div class="line"> &gt;app</div><div class="line"> &gt;bin</div><div class="line"> &gt;config</div><div class="line"> &gt;db</div><div class="line"> &gt;lib</div><div class="line"> &gt;log</div><div class="line"> &gt;public</div><div class="line"> &gt;test</div><div class="line"> &gt;tmp</div><div class="line"> &gt;vendor</div><div class="line"> -.gitignore</div><div class="line"> -config.ru</div><div class="line"> -Gemfile</div><div class="line"> -Gemfile.lock</div><div class="line"> -Rakefile</div><div class="line"> -README.md</div><div class="line"> 备注：其中^代表打开的文件夹；&gt;代表关闭的文件夹；-代表文件。</div></pre></td></tr></table></figure>
<p>下面对这些文件中比较关键的文件和目录做一下解释，主要介绍文件或者目录的用途。</p>
<ol>
<li>Gemfile：设置和管理Rails 应用程序中使用哪些gem。</li>
<li>Rakefile：用来加载可以被命令行执行的Rake任务，我们通过 rake -T 可以看到，如果加上 rake -T -D，可以看到详细的说明。</li>
<li>app目录：主要是包含controller，models和views，这三个目录可以说是在建站过程中最频繁使用到的。里面文件如下：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">^app</div><div class="line">&gt;assets</div><div class="line">&gt;channels</div><div class="line">&gt;controllers</div><div class="line">&gt;helpers</div><div class="line">&gt;jobs</div><div class="line">&gt;mailers</div><div class="line">&gt;models</div><div class="line">&gt;views</div><div class="line">备注：其中^代表打开的文件夹；&gt;代表关闭的文件夹</div></pre></td></tr></table></figure>
<ol>
<li>config目录：用来配置一些路由，数据库等。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">^config</div><div class="line">&gt;environments</div><div class="line">&gt;initializers</div><div class="line">&gt;locales</div><div class="line">-application.rb</div><div class="line">-boot.rb</div><div class="line">-cable.yml</div><div class="line">-database.yml</div><div class="line">-environment.rb</div><div class="line">-puma.rb</div><div class="line">-routes.rb</div><div class="line">-secrets.yml</div><div class="line">-spring.rb</div><div class="line">备注：其中^代表打开的文件夹；&gt;代表关闭的文件夹；-代表文件。</div></pre></td></tr></table></figure>
<p>其中这里面的routes是个特别重要的后续经常要用到的rb文件。</p>
<ol>
<li>db目录：显示数据库模式（database schema）和数据库迁移。如果你使用的是 sqlite 数据库，那么你会发现它存放在这里。sqlite 是一种小型的便于开发环境使用的数据库。在生产环境（production）的数据库，比如 mysql，postgres 等数据库文件，是不需要放到这里的。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">^db</div><div class="line">&gt;migrate</div><div class="line">-development.sqlite3</div><div class="line">-schema.rb</div><div class="line">-seeds.rb</div><div class="line">备注：其中^代表打开的文件夹；&gt;代表关闭的文件夹；-代表文件。</div></pre></td></tr></table></figure>
<ol>
<li>public目录：里面的文件是对外公开的，可以直接访问到的。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">^public</div><div class="line">&gt;404.html</div><div class="line">&gt;422.html</div><div class="line">&gt;500.html</div><div class="line">-apple-touch-icon-precomposed.png</div><div class="line">-apple-touch-icon.png</div><div class="line">-favicon.ico</div><div class="line">-robots.txt</div><div class="line">备注：其中^代表打开的文件夹；&gt;代表关闭的文件夹；-代表文件。</div></pre></td></tr></table></figure>
<h2 id="Step-2：把项目加进git-数据仓库-Repo"><a href="#Step-2：把项目加进git-数据仓库-Repo" class="headerlink" title="Step 2：把项目加进git 数据仓库(Repo)"></a>Step 2：把项目加进git 数据仓库(Repo)</h2><p>在Terminal中敲入：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git init</div></pre></td></tr></table></figure>
<p>这样子就会在.git文件（这是项目文件下的一个隐藏文件，可以通过ls –a查看）下创建一个新的repository。</p>
<p>接着敲入：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git status</div></pre></td></tr></table></figure>
<p>就会列出很多的untracked files。</p>
<p>再接着敲入：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git add .</div></pre></td></tr></table></figure>
<p>这个command告诉git你要把所有当前目录及当前目录的子目录都加入到repo中。加入后操作git status确认一下，你会看到一系列的文件等待被提交（commit）。</p>
<p>再接着敲入：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git commit -m “Added all the things”</div></pre></td></tr></table></figure>
<p>这样就提交建立还原点，提交后可用再用git status查看一下，会发现提示：”nothing to commit, working directory clean”</p>
<p>到这点为止，你要是后面的操作有出现问题，可用通过git回到这里。至于要怎么做，其实我也还不知道，后面会学到的。</p>
<p><strong>干货提醒：以上用到的所有命令都要背诵下来。没有记住的同学请返回去再记一遍</strong></p>
<h2 id="Step-3：本地执行本项目"><a href="#Step-3：本地执行本项目" class="headerlink" title="Step 3：本地执行本项目"></a>Step 3：本地执行本项目</h2><p>在Terminal中敲入：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails server</div></pre></td></tr></table></figure>
<p>这样相当于“后台服务器”就运行起来，就可以查看该网站了。</p>
<p>在浏览器中敲入如下内容<a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a>，就可以看到类似下图的页面。</p>
<p><img src="http://oh2t3x3t2.bkt.clouddn.com/public/16-11-24/79968195.jpg?imageView/2/w/400" alt="rails running"></p>
<p>备注：1、采用Ctrl+C可以退出运行；2、如果打rails server -p 4000就要对应到网址：<a href="http://localhost:4000" target="_blank" rel="external">http://localhost:4000</a></p>
<h2 id="Step-4：创建一个Migration"><a href="#Step-4：创建一个Migration" class="headerlink" title="Step 4：创建一个Migration"></a>Step 4：创建一个Migration</h2><p>我们要在Terminal中敲入如下信息：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails  generate scaffold topic <span class="symbol">title:</span>string <span class="symbol">description:</span>text</div></pre></td></tr></table></figure>
<p>这样，我们就创建了一个主题topic，这个主题有标题（title）和描述（description）。</p>
<p>我们可以从命令行里看到我们通过scaffold创建了如下这么多个是文件和目录：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">Running via Spring preloader <span class="keyword">in</span> process <span class="number">18723</span></div><div class="line">      invoke  active_record</div><div class="line">      create    db/migrate/<span class="number">20161122164227_</span>create_topics.rb</div><div class="line">      create    app/models/topic.rb</div><div class="line">      invoke    test_unit</div><div class="line">      create      test/models/topic_test.rb</div><div class="line">      create      test/fixtures/topics.yml</div><div class="line">      invoke  resource_route</div><div class="line">       route    resources <span class="symbol">:topics</span></div><div class="line">      invoke  scaffold_controller</div><div class="line">      create    app/controllers/topics_controller.rb</div><div class="line">      invoke    erb</div><div class="line">      create      app/views/topics</div><div class="line">      create      app/views/topics/index.html.erb</div><div class="line">      create      app/views/topics/edit.html.erb</div><div class="line">      create      app/views/topics/show.html.erb</div><div class="line">      create      app/views/topics/new.html.erb</div><div class="line">      create      app/views/topics/_form.html.erb</div><div class="line">      invoke    test_unit</div><div class="line">      create      test/controllers/topics_controller_test.rb</div><div class="line">      invoke    helper</div><div class="line">      create      app/helpers/topics_helper.rb</div><div class="line">      invoke      test_unit</div><div class="line">      invoke    jbuilder</div><div class="line">      create      app/views/topics/index.json.jbuilder</div><div class="line">      create      app/views/topics/show.json.jbuilder</div><div class="line">      create      app/views/topics/_topic.json.jbuilder</div><div class="line">      invoke  assets</div><div class="line">      invoke    coffee</div><div class="line">      create      app/assets/javascripts/topics.coffee</div><div class="line">      invoke    scss</div><div class="line">      create      app/assets/stylesheets/topics.scss</div><div class="line">      invoke  scss</div><div class="line">      create    app/assets/stylesheets/scaffolds.scss</div></pre></td></tr></table></figure>
<p>特别需要注意的是，以上操作其实只是通过scaffold来产生了所有功能的脚本（script），放在db/migrate/xxxx_create_topics.rb下。这些脚本不会自动执行。要让这些功能完整生效，就要执行下面的指令：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rake <span class="symbol">db:</span>migrate</div></pre></td></tr></table></figure>
<h3 id="4-1-知识点解释"><a href="#4-1-知识点解释" class="headerlink" title="4.1 知识点解释"></a>4.1 知识点解释</h3><h4 id="知识点一：migration-amp-rake"><a href="#知识点一：migration-amp-rake" class="headerlink" title="知识点一：migration &amp; rake"></a>知识点一：migration &amp; rake</h4><p>migration，即数据迁移，简而言之，就是用来建立修改管理数据库资料的。</p>
<p>Rails使用了Migration数据库迁移机制来定义数据库结构(Schema)，文件位于db/migrate/目录下。它的目的在于:</p>
<ul>
<li><strong>让数据库的修改也可以纳入版本控制系统</strong>，所有的变更都透过撰写Migration文件执行</li>
<li><strong>方便应用程式更新升级</strong>，例如让软件从第三版更新到第五版，数据库更新只需要执行rake db:migrate</li>
<li><strong>跨数据库通用</strong>，不需修改程式就可以用在SQLite3、MySQL、Postgres等不同数据库</li>
</ul>
<p>具体可以详见：<a href="http://edgeguides.rubyonrails.org/active_record_migrations.html" target="_blank" rel="external">http://edgeguides.rubyonrails.org/active_record_migrations.html</a> 及<a href="https://ihower.tw/rails/basic-cn.html" target="_blank" rel="external">https://ihower.tw/rails/basic-cn.html</a></p>
<h4 id="知识点二：scaffolding"><a href="#知识点二：scaffolding" class="headerlink" title="知识点二：scaffolding"></a>知识点二：scaffolding</h4><p>Rails的scaffolding会自动产生一组Model、Views和Controller的程序，完成一个简易的CRUD程序以供展示和学习用。听说资深程序员基本不用scaffolding，而是偏向从头建立Models、Views和Controllers。</p>
<p>更多信息可参看：<a href="http://guides.rubyonrails.org/command_line.html" target="_blank" rel="external">http://guides.rubyonrails.org/command_line.html</a>和<a href="https://ihower.tw/rails/basic-cn.html" target="_blank" rel="external">https://ihower.tw/rails/basic-cn.html</a></p>
<h2 id="Step-5：使用scaffolding进行CRUD"><a href="#Step-5：使用scaffolding进行CRUD" class="headerlink" title="Step 5：使用scaffolding进行CRUD"></a>Step 5：使用scaffolding进行CRUD</h2><p>把服务器运行起来：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails server</div></pre></td></tr></table></figure>
<p>而后，输入<a href="http://localhost:3000/topics" target="_blank" rel="external">http://localhost:3000/topics</a>，可以看到：</p>
<p><img src="http://oh2t3x3t2.bkt.clouddn.com/public/16-11-24/31753856.jpg?imageView/2/w/400" alt="rails running"></p>
<p>这样子就可以去做一系列的事情包括：显示、修改、删除。</p>
<p>那这些页面是怎么样被创建且绑定在一起的呢？Rails内建的scaffold做的。这都创建了什么东西呢？</p>
<ul>
<li><ol>
<li>app/models/topic.rb</li>
</ol>
</li>
</ul>
<p>这个文件，几乎是空的，如下所示，CRUD的记录都被rails中内建了。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Topic</span> &lt; ApplicationRecord</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这里我们第一次看到了.rb结尾的文件，这个就是ruby文件。意思是Topic这个类是从ApplicationRecord继承来的。</p>
<ul>
<li><ol>
<li>app/views/topics</li>
</ol>
</li>
</ul>
<p>这个文件夹包含了所有topic model的views，这里就是存放上面网页中显示的那些页面的相关代码。Rails的scaffold创建了这些页面。</p>
<ul>
<li><ol>
<li>app/views/topics/index.html.erb</li>
</ol>
</li>
</ul>
<p>这个是列出所有主题topics的代码，index是一个网站或者网站某章节默认的页面。</p>
<p>这里的代码是这样的：</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&lt;p id="notice"&gt;&lt;%=<span class="ruby"> notice </span>%&gt;&lt;/p&gt;</div><div class="line"></div><div class="line">&lt;h1&gt;Topics&lt;/h1&gt;</div><div class="line"></div><div class="line">&lt;table&gt;</div><div class="line">  &lt;thead&gt;</div><div class="line">    &lt;tr&gt;</div><div class="line">      &lt;th&gt;Title&lt;/th&gt;</div><div class="line">      &lt;th&gt;Description&lt;/th&gt;</div><div class="line">      &lt;th colspan="3"&gt;&lt;/th&gt;</div><div class="line">    &lt;/tr&gt;</div><div class="line">  &lt;/thead&gt;</div><div class="line"></div><div class="line">  &lt;tbody&gt;</div><div class="line">    &lt;%<span class="ruby"> @topics.each <span class="keyword">do</span> <span class="params">|topic|</span> </span>%&gt;</div><div class="line">      &lt;tr&gt;</div><div class="line">        &lt;td&gt;&lt;%=<span class="ruby"> topic.title </span>%&gt;&lt;/td&gt;</div><div class="line">        &lt;td&gt;&lt;%=<span class="ruby"> topic.description </span>%&gt;&lt;/td&gt;</div><div class="line">        &lt;td&gt;&lt;%=<span class="ruby"> link_to <span class="string">'Show'</span>, topic </span>%&gt;&lt;/td&gt;</div><div class="line">        &lt;td&gt;&lt;%=<span class="ruby"> link_to <span class="string">'Edit'</span>, edit_topic_path(topic) </span>%&gt;&lt;/td&gt;</div><div class="line">        &lt;td&gt;&lt;%=<span class="ruby"> link_to <span class="string">'Destroy'</span>, topic, <span class="symbol">method:</span> <span class="symbol">:delete</span>, <span class="symbol">data:</span> &#123; <span class="symbol">confirm:</span> <span class="string">'Are you sure?'</span> &#125; </span>%&gt;&lt;/td&gt;</div><div class="line">      &lt;/tr&gt;</div><div class="line">    &lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;</div><div class="line">  &lt;/tbody&gt;</div><div class="line">&lt;/table&gt;</div><div class="line"></div><div class="line">&lt;br&gt;</div><div class="line"></div><div class="line">&lt;%=<span class="ruby"> link_to <span class="string">'New Topic'</span>, new_topic_path </span>%&gt;</div></pre></td></tr></table></figure>
<p>这里就是主界面的代码。</p>
<h3 id="5-1知识点解释"><a href="#5-1知识点解释" class="headerlink" title="5. 1知识点解释"></a>5. 1知识点解释</h3><h4 id="知识点一：-topics"><a href="#知识点一：-topics" class="headerlink" title="知识点一：@topics"></a>知识点一：@topics</h4><p>@topics是哪里来的呢？</p>
<p>看topics_controller中如下方法：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span></span></div><div class="line">  @topics = Topic.all</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>Topic.all会抓出所有的资料，回传一个阵列给实例变量(instance variables)指派给@topics，Rails会让Action里的实例变量(也就是有@开头的变量)通通传到View模板（template）里面被使用。这个Action默认使用的模板是app/views/topics/目录下与Action同名（这里即index）的文件，也就是app/views/topics/index.html.erb中的内容。</p>
<p>这个View循环遍历主题并显示内容和超链接，有几件值得注意的事情：</p>
<blockquote>
<ul>
<li>在views中的文件都是以html.erb后缀结尾的，.html.erb后缀实际上是在告诉rails，要借助于erb系统对文件的内容进行扩展。erb是一个过滤器：进去的是.html.erb文件，出来的是经过转换的内容—在rails中，输出的文件通常是HTML格式，但也可以是别的任何东西，普通的内容会直进直出，没有任何变化。</li>
<li>&lt;%=和%&gt;之间的内容则会被看做Ruby代码执行，执行的结果将被转换成字符串，并替换到文件中&lt;%=…%&gt;所在的位置。</li>
<li>&lt;%和&lt;%=不太一样，前者只执行不输出，像用来迭代的each和end这两行就不需要输出，也就是执行结果不输出。而后者&lt;%= 里的结果会输出给浏览器。而那个结尾%&gt;和-%&gt;有什么区别呢？加-的意思是告诉rails将紧跟其后的换行符去掉。</li>
<li>link_to建立超链接到一个特定的位置，这里为浏览、编辑和删除都提供了超链接。</li>
</ul>
</blockquote>
<h4 id="知识点二：edit-topic-path-topic-amp-new-topic-path"><a href="#知识点二：edit-topic-path-topic-amp-new-topic-path" class="headerlink" title="知识点二：edit_topic_path(topic) &amp; new_topic_path"></a>知识点二：edit_topic_path(topic) &amp; new_topic_path</h4><p>edit_topic_path(topic)这个是什么意思啊？为什么一个路径会加上括号和参数？意思是该topic的路径？可以这样记：因为edit是单数，所有需要topic作为参数。</p>
<p>那为什么new_topic_path为什么不需要参数呢？</p>
<ul>
<li>app/views/topics/show.html.erb</li>
</ul>
<p>当点击show时候会出现的页面。具体内容如下：</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;p id="notice"&gt;&lt;%=<span class="ruby"> notice </span>%&gt;&lt;/p&gt;</div><div class="line"></div><div class="line">&lt;p&gt;</div><div class="line">  &lt;strong&gt;Title:&lt;/strong&gt;</div><div class="line">  &lt;%=<span class="ruby"> @topic.title </span>%&gt;</div><div class="line">&lt;/p&gt;</div><div class="line"></div><div class="line">&lt;p&gt;</div><div class="line">  &lt;strong&gt;Description:&lt;/strong&gt;</div><div class="line">  &lt;%=<span class="ruby"> @topic.description </span>%&gt;</div><div class="line">&lt;/p&gt;</div><div class="line"></div><div class="line">&lt;%=<span class="ruby"> link_to <span class="string">'Edit'</span>, edit_topic_path(@topic) </span>%&gt; |</div><div class="line">&lt;%=<span class="ruby"> link_to <span class="string">'Back'</span>, topics_path </span>%&gt;</div></pre></td></tr></table></figure>
<h3 id="5-2-知识点解释"><a href="#5-2-知识点解释" class="headerlink" title="5.2 知识点解释"></a>5.2 知识点解释</h3><h4 id="知识点一：-topic从哪来？"><a href="#知识点一：-topic从哪来？" class="headerlink" title="知识点一：@topic从哪来？"></a>知识点一：@topic从哪来？</h4><p>我暂时的理解：是从Controller中show action中传递过来的吗？可是controller中的方法没有定义内容哟，我的理解是因为@topic本身是实例变量，实例变量在使用范围是在整个类中，所以可以这样，待进一步理解和验证。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span></span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h4 id="知识点二：edit-topic-path-topic"><a href="#知识点二：edit-topic-path-topic" class="headerlink" title="知识点二：edit_topic_path(@topic)"></a>知识点二：edit_topic_path(@topic)</h4><p>上面已经提到过了，当前topic的编辑路径，对应到edit.html.erb的地方。这里edit是单数，所有需要@topic参数。</p>
<h4 id="知识点三：topics-path"><a href="#知识点三：topics-path" class="headerlink" title="知识点三：topics_path"></a>知识点三：topics_path</h4><p>这里用复数，代表的是整个topics的主界面。所以不需要参数。</p>
<ul>
<li>app/views/topics/new.html.erb</li>
</ul>
<p>当点击New Topic的时候会出现的页面。具体内容如下：</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;h1&gt;New Topic&lt;/h1&gt;</div><div class="line"></div><div class="line">&lt;%=<span class="ruby"> render <span class="string">'form'</span>, <span class="symbol">topic:</span> @topic </span>%&gt;</div><div class="line"></div><div class="line">&lt;%=<span class="ruby"> link_to <span class="string">'Back'</span>, topics_path </span>%&gt;</div></pre></td></tr></table></figure>
<h3 id="5-3-知识点解释"><a href="#5-3-知识点解释" class="headerlink" title="5.3 知识点解释"></a>5.3 知识点解释</h3><h4 id="知识点一：render-‘form’-topic-topic"><a href="#知识点一：render-‘form’-topic-topic" class="headerlink" title="知识点一：render ‘form’, topic: @topic"></a>知识点一：render ‘form’, topic: @topic</h4><p>这里的render ‘form’, topic: @topic的意思是将@topic变量传入局部视图_form.html.erb这个文件的topic本地变量，具体参考app/views/topics/ _form.html.erb中的解释。</p>
<p>进一步参考资料：</p>
<p><a href="http://guides.ruby-china.org/layouts_and_rendering.html" target="_blank" rel="external">http://guides.ruby-china.org/layouts_and_rendering.html</a></p>
<p><a href="http://guides.ruby-china.org/action_view_overview.html" target="_blank" rel="external">http://guides.ruby-china.org/action_view_overview.html</a></p>
<p><a href="http://cloudy9101.com/2014/1202/railszhong-renderde-yong-fa-zong-jie/" target="_blank" rel="external">http://cloudy9101.com/2014/1202/railszhong-renderde-yong-fa-zong-jie/</a></p>
<ul>
<li>app/views/topics/edit.html.erb</li>
</ul>
<p>点击edit的时候会出现的页面。</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;h1&gt;Editing Topic&lt;/h1&gt;</div><div class="line"></div><div class="line">&lt;%=<span class="ruby"> render <span class="string">'form'</span>, <span class="symbol">topic:</span> @topic </span>%&gt;</div><div class="line"></div><div class="line">&lt;%=<span class="ruby"> link_to <span class="string">'Show'</span>, @topic </span>%&gt; |</div><div class="line">&lt;%=<span class="ruby"> link_to <span class="string">'Back'</span>, topics_path </span>%&gt;</div></pre></td></tr></table></figure>
<p>这个信息和new.html.erb差不多，似乎没必要再解释。</p>
<ul>
<li>app/views/topics/_form.html.erb</li>
</ul>
<p>下划线开头的是partial，就是有很多页面有相同的form的时候，可以把相同的部分独立开来放到一个下划线开头的文件。</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;%=<span class="ruby"> form_for(topic) <span class="keyword">do</span> <span class="params">|f|</span> </span>%&gt;</div><div class="line">  &lt;%<span class="ruby"> <span class="keyword">if</span> topic.errors.any? </span>%&gt;</div><div class="line">    &lt;div id="error_explanation"&gt;</div><div class="line">      &lt;h2&gt;&lt;%=<span class="ruby"> pluralize(topic.errors.count, <span class="string">"error"</span>) </span>%&gt; prohibited this topic from being saved:&lt;/h2&gt;</div><div class="line"></div><div class="line">      &lt;ul&gt;</div><div class="line">      &lt;%<span class="ruby"> topic.errors.full_messages.each <span class="keyword">do</span> <span class="params">|message|</span> </span>%&gt;</div><div class="line">        &lt;li&gt;&lt;%=<span class="ruby"> message </span>%&gt;&lt;/li&gt;</div><div class="line">      &lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;</div><div class="line">      &lt;/ul&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;</div><div class="line"></div><div class="line">  &lt;div class="field"&gt;</div><div class="line">    &lt;%=<span class="ruby"> f.label <span class="symbol">:title</span> </span>%&gt;</div><div class="line">    &lt;%=<span class="ruby"> f.text_field <span class="symbol">:title</span> </span>%&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line"></div><div class="line">  &lt;div class="field"&gt;</div><div class="line">    &lt;%=<span class="ruby"> f.label <span class="symbol">:description</span> </span>%&gt;</div><div class="line">    &lt;%=<span class="ruby"> f.text_area <span class="symbol">:description</span> </span>%&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line"></div><div class="line">  &lt;div class="actions"&gt;</div><div class="line">    &lt;%=<span class="ruby"> f.submit </span>%&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;</div></pre></td></tr></table></figure>
<h3 id="5-4-知识点解释"><a href="#5-4-知识点解释" class="headerlink" title="5.4 知识点解释"></a>5.4 知识点解释</h3><h4 id="知识点一：form-for"><a href="#知识点一：form-for" class="headerlink" title="知识点一：form_for"></a>知识点一：form_for</h4><p><a href="http://api.rubyonrails.org" target="_blank" rel="external">http://api.rubyonrails.org</a> 里对form_for的解释是：创建一个表单，这个表单允许用户创建或更新特定Model对象的属性。（Creates a form that allows the user to create or update the attributes of a specific model object.）说明是rails内置的东西，只需要拿出来用就是。</p>
<h3 id="5-5-进一步研究"><a href="#5-5-进一步研究" class="headerlink" title="5.5 进一步研究"></a>5.5 进一步研究</h3><p>我试着把_form.html.erb中的所有topic改成@topic，把new.html.erb的“, topic: @topic”去掉，即</p>
<p>_form.html.erb改成：</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;%=<span class="ruby"> form_for(@topic) <span class="keyword">do</span> <span class="params">|f|</span> </span>%&gt;</div><div class="line">  &lt;%<span class="ruby"> <span class="keyword">if</span> @topic.errors.any? </span>%&gt;</div><div class="line">    &lt;div id="error_explanation"&gt;</div><div class="line">      &lt;h2&gt;&lt;%=<span class="ruby"> pluralize(@topic.errors.count, <span class="string">"error"</span>) </span>%&gt; prohibited this topic from being saved:&lt;/h2&gt;</div><div class="line"></div><div class="line">      &lt;ul&gt;</div><div class="line">      &lt;%<span class="ruby"> @topic.errors.full_messages.each <span class="keyword">do</span> <span class="params">|message|</span> </span>%&gt;</div><div class="line">        &lt;li&gt;&lt;%=<span class="ruby"> message </span>%&gt;&lt;/li&gt;</div><div class="line">      &lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;</div><div class="line">      &lt;/ul&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;</div><div class="line"></div><div class="line">  &lt;div class="field"&gt;</div><div class="line">    &lt;%=<span class="ruby"> f.label <span class="symbol">:title</span> </span>%&gt;</div><div class="line">    &lt;%=<span class="ruby"> f.text_field <span class="symbol">:title</span> </span>%&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line"></div><div class="line">  &lt;div class="field"&gt;</div><div class="line">    &lt;%=<span class="ruby"> f.label <span class="symbol">:description</span> </span>%&gt;</div><div class="line">    &lt;%=<span class="ruby"> f.text_area <span class="symbol">:description</span> </span>%&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line"></div><div class="line">  &lt;div class="actions"&gt;</div><div class="line">    &lt;%=<span class="ruby"> f.submit </span>%&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;</div></pre></td></tr></table></figure>
<p>new.html.erb改成：</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;h1&gt;New Topic&lt;/h1&gt;</div><div class="line"></div><div class="line">&lt;%=<span class="ruby"> render <span class="string">'form'</span> </span>%&gt;</div><div class="line"></div><div class="line">&lt;%=<span class="ruby"> link_to <span class="string">'Back'</span>, topics_path </span>%&gt;</div></pre></td></tr></table></figure>
<p>改成这样后，发现还是可以跑起来的。这说明了这个@topic是可以在topics这个文件夹中的所有表单里调用的。</p>
<ul>
<li>app/controllers /topics_controller.rb</li>
</ul>
<p>这个是controller文件，你会发现里面有很多views文件夹下面.html.erb子文件对应的方法。看下面#中的解释有助于理解。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TopicsController</span> &lt; ApplicationController</span></div><div class="line">  <span class="comment"># before_action是用来将Controller中重复的程序独立出来。</span></div><div class="line">  before_action <span class="symbol">:set_topic</span>, <span class="symbol">only:</span> [<span class="symbol">:show</span>, <span class="symbol">:edit</span>, <span class="symbol">:update</span>, <span class="symbol">:destroy</span>]</div><div class="line"></div><div class="line">  <span class="comment"># GET /topics</span></div><div class="line">  <span class="comment"># GET /topics.json</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">index</span></span></div><div class="line">    @topics = Topic.all</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># GET /topics/1</span></div><div class="line">  <span class="comment"># GET /topics/1.json</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">show</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># GET /topics/new</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">new</span></span></div><div class="line">    @topic = Topic.new</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># GET /topics/1/edit</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">edit</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># POST /topics</span></div><div class="line">  <span class="comment"># POST /topics.json</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">create</span></span></div><div class="line">    @topic = Topic.new(topic_params)</div><div class="line">    <span class="comment"># respond_to 可以让我们在同一个Action中，支援不同的资料格式，例如XML、JSON、Atom等。</span></div><div class="line">    respond_to <span class="keyword">do</span> <span class="params">|format|</span></div><div class="line">      <span class="keyword">if</span> @topic.save</div><div class="line">        <span class="comment">#我们先背诵下来这样的格式。</span></div><div class="line">        format.html &#123; redirect_to @topic, <span class="symbol">notice:</span> <span class="string">'Topic was successfully created.'</span> &#125;</div><div class="line">        format.json &#123; render <span class="symbol">:show</span>, <span class="symbol">status:</span> <span class="symbol">:created</span>, <span class="symbol">location:</span> @topic &#125;</div><div class="line">      <span class="keyword">else</span></div><div class="line">        format.html &#123; render <span class="symbol">:new</span> &#125;</div><div class="line">        format.json &#123; render <span class="symbol">json:</span> @topic.errors, <span class="symbol">status:</span> <span class="symbol">:unprocessable_entity</span> &#125;</div><div class="line">      <span class="keyword">end</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># PATCH/PUT /topics/1</span></div><div class="line">  <span class="comment"># PATCH/PUT /topics/1.json</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update</span></span></div><div class="line">    respond_to <span class="keyword">do</span> <span class="params">|format|</span></div><div class="line">      <span class="keyword">if</span> @topic.update(topic_params)</div><div class="line">        format.html &#123; redirect_to @topic, <span class="symbol">notice:</span> <span class="string">'Topic was successfully updated.'</span> &#125;</div><div class="line">        format.json &#123; render <span class="symbol">:show</span>, <span class="symbol">status:</span> <span class="symbol">:ok</span>, <span class="symbol">location:</span> @topic &#125;</div><div class="line">      <span class="keyword">else</span></div><div class="line">        format.html &#123; render <span class="symbol">:edit</span> &#125;</div><div class="line">        format.json &#123; render <span class="symbol">json:</span> @topic.errors, <span class="symbol">status:</span> <span class="symbol">:unprocessable_entity</span> &#125;</div><div class="line">      <span class="keyword">end</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># DELETE /topics/1</span></div><div class="line">  <span class="comment"># DELETE /topics/1.json</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">destroy</span></span></div><div class="line">    @topic.destroy</div><div class="line">    respond_to <span class="keyword">do</span> <span class="params">|format|</span></div><div class="line">      format.html &#123; redirect_to topics_url, <span class="symbol">notice:</span> <span class="string">'Topic was successfully destroyed.'</span> &#125;</div><div class="line">      format.json &#123; head <span class="symbol">:no_content</span> &#125;</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  private</div><div class="line">    <span class="comment"># Use callbacks to share common setup or constraints between actions.</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_topic</span></span></div><div class="line">      @topic = Topic.find(params[<span class="symbol">:id</span>])</div><div class="line">    <span class="keyword">end</span></div><div class="line"></div><div class="line">    <span class="comment"># Never trust parameters from the scary internet, only allow the white list through.</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">topic_params</span></span></div><div class="line">      params.<span class="keyword">require</span>(<span class="symbol">:topic</span>).permit(<span class="symbol">:title</span>, <span class="symbol">:description</span>)</div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h3 id="5-6-余留问题"><a href="#5-6-余留问题" class="headerlink" title="5.6 余留问题"></a>5.6 余留问题</h3><p>topic.errors.any? 如何解？待进一步研究。</p>
<h2 id="Step-6：设置默认页面"><a href="#Step-6：设置默认页面" class="headerlink" title="Step 6：设置默认页面"></a>Step 6：设置默认页面</h2><p>在config/routes.rb文件中加入这行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root ‘topics#index’</div></pre></td></tr></table></figure>
<p>root ‘topics#index’这句设置了网站的默认地址。Rails route控制着url对应的controller action。就如地址对应着房子的位置。</p>
<p>Routes.rb 使用简单的语法，所以没有显示所有可能的urls，想要知道句的urls的更详细信息，可以在terminal中打入rake routes，或者其实也可以通过<a href="http://localhost:3000/rails/info" target="_blank" rel="external">http://localhost:3000/rails/info</a> 去查看。我们会看到如下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">    Prefix Verb   URI Pattern                Controller#Action</div><div class="line">    topics GET    /topics(.:format)          topics#index</div><div class="line">           POST   /topics(.:format)          topics#create</div><div class="line"> new_topic GET    /topics/new(.:format)      topics#new</div><div class="line">edit_topic GET    /topics/:id/edit(.:format) topics#edit</div><div class="line">     topic GET    /topics/:id(.:format)      topics#show</div><div class="line">           PATCH  /topics/:id(.:format)      topics#update</div><div class="line">           PUT    /topics/:id(.:format)      topics#update</div><div class="line">           DELETE /topics/:id(.:format)      topics#destroy</div></pre></td></tr></table></figure>
<p>这里Prefix，即前缀，搭配_path（这个是相对网址）或者 _url（这个是绝对网址）可以组合成helper方法。例如new_topic_path这样的方法，就会产生/topics/new这样的网址；edit_topic_path这样的方法，产生topics/23/edit这样的网址。一般来说大部分都会用 _path。特别注意一下其他action，即index，create，new，edit，show，update，destroy，是rails定好的，无法修改，要背诵起来。可以这样记：</p>
<blockquote>
<ul>
<li>show, new, edit, update, destroy 是单数，对单一元素操作</li>
<li>index, create是复数，对多数操作</li>
<li>topic_path(@topic)需要参数，根据HTTP动词show, update, destroy.</li>
<li>topics_path无需参数，根据HTTP动词决定index, create.</li>
</ul>
</blockquote>
<p>routes的进一步信息参考<a href="http://guides.rubyonrails.org/routing.html" target="_blank" rel="external">http://guides.rubyonrails.org/routing.html</a></p>
<h2 id="Step-7：对文章做投票"><a href="#Step-7：对文章做投票" class="headerlink" title="Step 7：对文章做投票"></a>Step 7：对文章做投票</h2><p> 在这个项目中，我们希望可以对每个topic进行投票。我们需要建立一个vote的model，使用下面的命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails generate model vote topic_id:integer</div></pre></td></tr></table></figure>
<p>创建了如下所示的文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Running via Spring preloader in process 10895</div><div class="line">      invoke  active_record</div><div class="line">      create    db/migrate/20161125024243_create_votes.rb</div><div class="line">      create    app/models/vote.rb</div><div class="line">      invoke    test_unit</div><div class="line">      create      test/models/vote_test.rb</div><div class="line">      create      test/fixtures/votes.yml</div></pre></td></tr></table></figure>
<p>同样的道理，要让这些功能完整生效，就要执行下面的指令：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rake <span class="symbol">db:</span>migrate</div></pre></td></tr></table></figure>
<p>你会看到这样的信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ rake db:migrate</div><div class="line">== 20161125024243 CreateVotes: migrating ======================================</div><div class="line">-- create_table(:votes)</div><div class="line">   -&gt; 0.0140s</div><div class="line">== 20161125024243 CreateVotes: migrated (0.0144s) =============================</div></pre></td></tr></table></figure>
<p>这次为什么不是用scaffold来生成呢？因为这次我们不是要创建一个完整的vote的CRUD，而只是把vote当做topics的一部分。</p>
<p>Note：这里的topic_id是用来连接votes和topics的。</p>
<h2 id="Step-8：把votes和topics连在一起"><a href="#Step-8：把votes和topics连在一起" class="headerlink" title="Step 8：把votes和topics连在一起"></a>Step 8：把votes和topics连在一起</h2><p>打开app/models/topic.rb这个文件，我们会看到如下的内容</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Topic</span> &lt; ApplicationRecord</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>Topic这个类是从ApplicationRecord继承下来的。 这个基本概念掌握了以后，就可以接下来操作，在中间加入这行has_many:votes, dependent: :destroy，变成如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Topic</span> &lt; ApplicationRecord</span></div><div class="line">    has_many <span class="symbol">:votes</span>, <span class="symbol">dependent:</span> <span class="symbol">:destroy</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>接着再在app/models/vote.rb中加入如下belongs_to:topic，变成这样：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vote</span> &lt; ApplicationRecord</span></div><div class="line">     belongs_to <span class="symbol">:topic</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这样子，vote和topic的关系就基本建立好了。 </p>
<h3 id="8-1-知识点解释"><a href="#8-1-知识点解释" class="headerlink" title="8.1 知识点解释"></a>8.1 知识点解释</h3><h4 id="知识点一：-has-many-votes-dependent-destroy"><a href="#知识点一：-has-many-votes-dependent-destroy" class="headerlink" title="知识点一： has_many :votes, dependent: :destroy"></a>知识点一： has_many :votes, dependent: :destroy</h4><p>首先，has_many :votes顾名思义，就是指每个Topic都会有很多选票。而dependent::destroy的意思是当topic被删除的时候，相应的所有votes也会被删除。这个可以直接背诵下来。</p>
<p>votes的前面为什么是有一个冒号呢？</p>
<p>这里的:votes是一个symbol，可以把symbol看成是一个没有约束的字符串。Symbol是Ruby 特有的一个数据类型，其他语言很少用到，初看起来感觉很奇怪，不过Rails 经常用到它，所以你很快就会习惯的。</p>
<p>可以顺便认识一下hash，先有个概念：user= { :name =&gt; “Michael Hartl”, :email =&gt;”michael@example.com” } 这样子就用symbol建了一个hash。现在也可以写成这样：{ name: “Michael Hartl”, email: “michael@example.com” }，两者的意思是相同的。</p>
<p>更详细信息，可以参考中文版的<a href="https://railstutorial-china.org/rails3/chapter4.html" target="_blank" rel="external">https://railstutorial-china.org/rails3/chapter4.html</a></p>
<p>或者英文版的：<a href="https://www.railstutorial.org/book/rails_flavored_ruby%23sec-hashes_and_symbols" target="_blank" rel="external">https://www.railstutorial.org/book/rails_flavored_ruby#sec-hashes_and_symbols</a></p>
<p>好了，毕竟是初学，也不要跑得太远了，我们进行下一个步骤。</p>
<h2 id="Step-9：让我们可以投票"><a href="#Step-9：让我们可以投票" class="headerlink" title="Step 9：让我们可以投票"></a>Step 9：让我们可以投票</h2><p>为了让我们可以投票，我们需要做以下事情：</p>
<ol>
<li>首先，要在页面上有个可以投票点加1的按钮。</li>
<li>接着，要有个计数的显示。</li>
<li>最后，要能够点按钮的时候，能计数并把计数结果显示出来。</li>
</ol>
<p>这样，我们就需要在controller写出投票的程序，并用route把按钮和程序连接在一起。</p>
<p>我们来具体看要如何操作：</p>
<p>在app/controllers/topic_controller.rb中private上面定义方法upvote</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">upvote</span></span></div><div class="line">    @topic = Topic.find(params[<span class="symbol">:id</span>])</div><div class="line">    @topic.votes.create</div><div class="line">    redirect_to(topics_path)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h3 id="9-1-知识点解释"><a href="#9-1-知识点解释" class="headerlink" title="9.1 知识点解释"></a>9.1 知识点解释</h3><h4 id="知识点一：upvote方法"><a href="#知识点一：upvote方法" class="headerlink" title="知识点一：upvote方法"></a>知识点一：upvote方法</h4><p>@topic = Topic.find(params[:id])是在数据库中通过find方法找到对应的topic且把它存到实例变量@topic。</p>
<p>@topic.votes.create 则是创建了个投票且把这个票存在数据库。</p>
<p>redirect_to(topics_path)就是重定向到这个路径。</p>
<p>接着把的把config/routes.rb文件的resources部分的内容改成这样：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">resources <span class="symbol">:topics</span> <span class="keyword">do</span></div><div class="line">  member <span class="keyword">do</span></div><div class="line">    post <span class="string">'upvote'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h3 id="9-2-知识点解释"><a href="#9-2-知识点解释" class="headerlink" title="9.2 知识点解释"></a>9.2 知识点解释</h3><h4 id="知识点一：member-do-post-‘upvote’"><a href="#知识点一：member-do-post-‘upvote’" class="headerlink" title="知识点一：member do post ‘upvote’"></a>知识点一：member do post ‘upvote’</h4><p>这段路由能识别 /topics/1/upvote 是个 post 请求，映射到 TopicsController 的 upvote 动作上，资源的 ID 传入 params[:id]。同时还生成了 upvote_topic_url 和 upvote_topic_path 两个帮助方法。背起来。</p>
<p>具体参考：<a href="http://guides.rubyonrails.org/routing.html" target="_blank" rel="external">http://guides.rubyonrails.org/routing.html</a> （英文）或者<a href="http://guides.ruby-china.org/routing.html（中文）中的2.10.1" target="_blank" rel="external">http://guides.ruby-china.org/routing.html（中文）中的2.10.1</a> Adding Member Routes中的解释。</p>
<p>这样过后，我们就通过rake routes命令或者在浏览器中打开<a href="http://localhost:3000/rails/info" target="_blank" rel="external">http://localhost:3000/rails/info</a> ，你会看到如下的信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ rake routes</div><div class="line">      Prefix Verb   URI Pattern                  Controller#Action</div><div class="line">        root GET    /                            topics#index</div><div class="line">upvote_topic POST   /topics/:id/upvote(.:format) topics#upvote</div><div class="line">      topics GET    /topics(.:format)            topics#index</div><div class="line">             POST   /topics(.:format)            topics#create</div><div class="line">   new_topic GET    /topics/new(.:format)        topics#new</div><div class="line">  edit_topic GET    /topics/:id/edit(.:format)   topics#edit</div><div class="line">       topic GET    /topics/:id(.:format)        topics#show</div><div class="line">             PATCH  /topics/:id(.:format)        topics#update</div><div class="line">             PUT    /topics/:id(.:format)        topics#update</div><div class="line">             DELETE /topics/:id(.:format)        topics#destroy</div></pre></td></tr></table></figure>
<p>你会看到多了个upvote_topic。这个就有了对应的upvote_topic_url 和 upvote_topic_path这两个帮助方法。</p>
<p>接着，编辑app/views/topics/index.html.erb文件，加入两行代码：</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;td&gt;&lt;%=<span class="ruby"> pluralize(topic.votes.count, <span class="string">"vote"</span>) </span>%&gt;&lt;/td&gt;</div><div class="line">&lt;td&gt;&lt;%=<span class="ruby"> button_to <span class="string">'+1'</span>, upvote_topic_path(topic), <span class="symbol">method:</span> <span class="symbol">:post</span> </span>%&gt;&lt;/td&gt;</div></pre></td></tr></table></figure>
<p>也就是变成：</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;%<span class="ruby"> @topics.each <span class="keyword">do</span> <span class="params">|topic|</span> </span>%&gt;</div><div class="line">  &lt;tr&gt;</div><div class="line">    &lt;td&gt;&lt;%=<span class="ruby"> topic.title </span>%&gt;&lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;%=<span class="ruby"> topic.description </span>%&gt;&lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;%=<span class="ruby"> pluralize(topic.votes.count, <span class="string">"vote"</span>) </span>%&gt;&lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;%=<span class="ruby"> button_to <span class="string">'+1'</span>, upvote_topic_path(topic), <span class="symbol">method:</span> <span class="symbol">:post</span> </span>%&gt;&lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;%=<span class="ruby"> link_to <span class="string">'Show'</span>, topic </span>%&gt;&lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;%=<span class="ruby"> link_to <span class="string">'Edit'</span>, edit_topic_path(topic) </span>%&gt;&lt;/td&gt;</div><div class="line">    &lt;td&gt;&lt;%=<span class="ruby"> link_to <span class="string">'Destroy'</span>, topic, <span class="symbol">method:</span> <span class="symbol">:delete</span>, <span class="symbol">data:</span> &#123; <span class="symbol">confirm:</span> <span class="string">'Are you sure?'</span> &#125; </span>%&gt;&lt;/td&gt;</div><div class="line">  &lt;/tr&gt;</div><div class="line">&lt;%<span class="ruby"> <span class="keyword">end</span> </span>%&gt;</div></pre></td></tr></table></figure>
<h3 id="9-3-知识点解释"><a href="#9-3-知识点解释" class="headerlink" title="9.3 知识点解释"></a>9.3 知识点解释</h3><h4 id="知识点一：pluralize-topic-votes-count-“vote”"><a href="#知识点一：pluralize-topic-votes-count-“vote”" class="headerlink" title="知识点一：pluralize(topic.votes.count, “vote”)"></a>知识点一：pluralize(topic.votes.count, “vote”)</h4><p>pluralize(topic.votes.count, “vote”) 是显示了每个topic的投票数，单数就是vote，复数就是votes。这个方法的详细解释可以在ruby on rails的API中查看到<a href="http://api.rubyonrails.org" target="_blank" rel="external">http://api.rubyonrails.org</a></p>
<h4 id="知识点二：button-to-‘-1’-upvote-topic-path-topic-method-post"><a href="#知识点二：button-to-‘-1’-upvote-topic-path-topic-method-post" class="headerlink" title="知识点二：button_to ‘+1’, upvote_topic_path(topic), method: :post"></a>知识点二：button_to ‘+1’, upvote_topic_path(topic), method: :post</h4><p>参数 ‘+1’ 创造了个+1按键，upvote_topic_path(topic) 建立一个我们要调用的action的URL，点击到此的话，就会对当前的topic进行一次投票。把它背下来就是。</p>
<p>详细信息参考<a href="http://guides.rubyonrails.org/routing.html" target="_blank" rel="external">http://guides.rubyonrails.org/routing.html</a></p>
<h4 id="知识点三：method-post"><a href="#知识点三：method-post" class="headerlink" title="知识点三：method: :post"></a>知识点三：method: :post</h4><p>保证我们采用 CRUD的create action，而不是read action。其实本来默认就是method: :post，所以其实这个可以去掉，改成：</p>
<figure class="highlight erb"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;td&gt;&lt;%=<span class="ruby"> button_to <span class="string">'+1'</span>, upvote_topic_path(topic), <span class="symbol">method:</span> <span class="symbol">:post</span> </span>%&gt;&lt;/td&gt;</div></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://rails-practice.com/" target="_blank" rel="external">https://rails-practice.com/</a></p>
<p><a href="http://api.rubyonrails.org" target="_blank" rel="external">http://api.rubyonrails.org</a> </p>
<p><a href="https://www.gitbook.com/book/liwei78/rails-practice/details" target="_blank" rel="external">https://www.gitbook.com/book/liwei78/rails-practice/details</a></p>
<p><a href="https://ihower.tw/rails/index-cn.html" target="_blank" rel="external">https://ihower.tw/rails/index-cn.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/06/我的全栈工程师之路02-Intro-To-Rails/" itemprop="url">
                  我的全栈工程师之路02-Intro To Rails
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-06T00:51:17+08:00" content="2016-11-06">
              2016-11-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/全栈工程师/" itemprop="url" rel="index">
                    <span itemprop="name">全栈工程师</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/06/我的全栈工程师之路02-Intro-To-Rails/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/11/06/我的全栈工程师之路02-Intro-To-Rails/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h2><ul>
<li>做一个Ruby on Rails实例</li>
<li>列出过程中出现的错误</li>
<li>总结教训继续前行</li>
<li>背诵</li>
</ul>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>IRB: Interative Ruby console 交互式Ruby 平台</p>
<p>CRUD: Create, Read, Update, Destroy.</p>
<p>gemfile: The Gemfile is a list of all the Ruby libraries your application needs.</p>
<p>Scaffold: A scaffold in Rails is a full set of model, database migration for that model, controller to manipulate it, views to view and manipulate the data, and a test suite for each of the above.</p>
<h2 id="重要步骤和知识点"><a href="#重要步骤和知识点" class="headerlink" title="重要步骤和知识点"></a>重要步骤和知识点</h2><p>git的使用步骤：git init-&gt;git status-&gt;git add .-&gt;git status-&gt;git commit -m “added all the things”-&gt;git status</p>
<p>By checking your application into git now, you’re creating a record of your starting point. Whenever you make a change during today’s workshop, we’ll add it to git before moving on. This way, if anything ever breaks, or you make a change you don’t like, you can use git as an all-powerful “undo” technique. But that only works when you remember to commit early and often!</p>
<p>运行：rails server-&gt; <a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a></p>
<p>rails server run your application locally just like Heroku will be running it on their servers.</p>
<p>Use scaffold to automatically generate the corresponding Scaffold in Rails:</p>
<p>Step: rails generate scaffold topic title:string description:text-&gt;rake db:migrate (This tells Rails to update the database to include a table for our new model.)</p>
<p>rake (ruby make) is a tool that allows you to run small programs that you use often in your application. </p>
<p>MVC:</p>
<p>Model: 1) For all the Models we create in RailsBridge, Model objects have a corresponding record in the database . <strong>the name of the table in the database is the plural version of the Model’s class name. for example Pig-&gt;pigs</strong>, The Model is a bridge between the database and your application’s code.</p>
<p>View: 1) The view generates the HTML that will be displayed in the browser. 2) View files are written in ERB, a templating language. It contains HTML with Ruby code embedded in it. </p>
<p>Controller: 1) Controllers pass Ruby objects between the Models and the Views. 2) Each url corresponds to a specific method in a Controller. 2) After this step, when your visit any page in your application, that request will be handled by a method in a controller.</p>
<p>设置首页：在config/routes.rb-&gt;添加这句：root ‘topics#index’ 。Rails routes control how URLs (web addresses) get matched with code on the server. Similar to how addresses match with houses and apartments.</p>
<p>Deploy to Heroku: heroku create-&gt;Edit the Gemfile-&gt;bundle install –without production (apply the Gemfile changes)-&gt; git add . git commit -m “changed Gemfile for Heroku”-&gt; git status -&gt; git push heroku master-&gt;heroku run rake db:migrate-&gt;heroku open</p>
<p>create Model: rails generate model vote topic_id:integer-&gt;rake db:migrate</p>
<p>has_many and belongs_to:</p>
<ul>
<li>In Rails, relationships between models are called associations. </li>
</ul>
<ul>
<li>Associations (usually) come in pairs.</li>
</ul>
<ul>
<li>A topic will have many votes so we put has_many :votes in the topic model.: When you ask a topic for its votes, you get an array of votes for that topic.</li>
<li>A vote is for a particular topic, so we put belongs_to :topic in the vote model.: When you ask a vote for its topic, you get the topic for that vote.</li>
</ul>
<p>It can still be important to clean up after yourself! dependent: :destroy on has_many :votes means when a Topic gets destroyed, all the votes that correspond to it will be destroyed, too. Without dependent :destroy, those votes would live on the database forever.</p>
<h2 id="错误总结"><a href="#错误总结" class="headerlink" title="错误总结"></a>错误总结</h2><p>错误1： 不知道怎么heroku create，原来是自己压根就没有装heroku，就安装和注册后登录进去可以创建。上传到heroku，要修改gemfile。</p>
<p>错误2：在执行rails generate scaffold topic title:string description:text中遇到停住，重启电脑后可用。</p>
<p>错误3：当把application部署到heroku后，忘记被Gemfile里面的内容修改回来，导致后面本地执行不了。</p>
<p>错误4：git commit -m “added。。。”，这个-m之后的一定要加吗？文档描述可不用加，可是没加的时候出现卡住。加了就没这个问题？</p>
<h2 id="背诵"><a href="#背诵" class="headerlink" title="背诵"></a>背诵</h2><p>remove app: rm -rf filename</p>
<p>create a new rails: rails new appname</p>
<p>While create a new Rails project, will be a lot directories and files including:</p>
<p>app/: Contains the controllers, models, and views for your application. You will do most of your work here.</p>
<p>config/: Configure your application’s runtime rules, routes, database, and more.</p>
<p>db/: Show yours current databased schema, as well as the databased migrations.</p>
<p>public/: The only folder seen to the world as-is. If you put files in here, they will be served directly without any processing by Rails.</p>
<p>app/assets/: This is where your images, Javascript, stylesheets and other static files should go. Modern Rails apps use something called the Assets Pipeline, which combines all the Javascript and CSS files in this directory into a single file for speediness.</p>
<p>rails server</p>
<p>rake -T: see a lit of all the rake commands your app currently respond to, along with a short description of each task.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/16/如何高品质地形成观点-1/" itemprop="url">
                  如何高品质地形成观点
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-16T20:39:31+08:00" content="2016-10-16">
              2016-10-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/16/如何高品质地形成观点-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/10/16/如何高品质地形成观点-1/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>首先我们来看一下什么是观点（这里阐述的“观点”是英语中的“opinion”，而且是偏向于在Critical Thinking（国内大部分翻译成批判性思考）下的opinion）？</p>
<p>维基百科中的解释是：</p>
<blockquote>
<p>In general, an opinion is a judgment, viewpoint, or statement that is not conclusive.</p>
<p>观点是一种判断，看法或者陈述，不是决定性的。</p>
</blockquote>
<p>朗文词典的解释是：</p>
<blockquote>
<p>Your ideas or beliefs about a particular subject. </p>
<p>对某一特定主题的想法或者信念。</p>
</blockquote>
<p>在《Beyond Feelings》这本书里的解释则是：</p>
<blockquote>
<p>In the context of critical thinking, the term opinion refers to expressions of judgment rather than to expressions of taste.<br>在独立性思考的背景下，观点这个术语指的是判断的表达，而不是喜好的表达。</p>
</blockquote>
<p>上面提到的那个定义中，其实都少不了跟“判断”相关，也就是说，观点是一种判断。既然是一种判断，就是可能是对的，也可能是错的，那么我们要怎么做到让我们的观点尽可能地做到对呢？换句话说，怎么让我们的观点尽可能地往高品质上靠呢？</p>
<p>在《Beyond Feelings》这本书的第五章里，作者Vincent是这么说的：</p>
<blockquote>
<ol>
<li>Understand how opinions are formed. 搞清楚观点是如何形成的</li>
<li>Resist the temptation to treat your opinions as facts. 抵制把你的观点当作是事实的诱惑</li>
<li>Monitor your thoughts to prevent the uncritical default mode from taking charge. 监控你的思想，以防止非批判性默认模式的掌控</li>
</ol>
</blockquote>
<p>备注：以上具体描述细节请参考书中原文。</p>
<p>在以上第1点的时候，作者说到，有两个模式：</p>
<blockquote>
<ul>
<li>Uncritical Default Mode (非批判性默认模式)：Preceive -&gt; Let an opinion “come to mind” -&gt; Focus on information that supports the opinion -&gt; Embrace the opinion (感知-&gt;集中于”脑中出现“的一种观点-&gt;集中于支持该观点的信息-&gt;接受该观点</li>
<li>Critical Thinking Mode (批判性思考模式)：Perceive -&gt; Investigate the issue -&gt; Consider alternative opinions -&gt; Decide which opinion is most reasonable (感知-&gt;调查该观点-&gt;考虑其他的观点-&gt;确定哪个观点是最合理的)</li>
</ul>
</blockquote>
<p>看到这里，让我想起很久以前在学校的我，当初在写论文或者做报告的时候，就是“不折不扣”的跟”非批判性默认模式“里说的一模一样的在做事情。首先，想起一个观点，然后，就是拼命地找支持该观点的各种描述和证据，最后整理出一份当初所谓的完整”报告“。你想，论点，论证，条理清晰，应有尽有……看起来是就是这样子：</p>
<blockquote>
<p>我得出的观点是：XXXXXX</p>
<p>原因如下：</p>
<ol>
<li>X1……</li>
<li>X2……</li>
<li>X3……</li>
</ol>
</blockquote>
<p>而这样的报告，在学校里，竟然看过的人都很认同，包括老师。天啊！</p>
<p>过了一段时间，我自己的认知已经得到升级，无形中已经修改的自己的方法论（只不过之前没有深入思考这个就是方法论而已），我是这么做的：我会列出相关的选择，列出各个选项的支持和不支持理由，最终对比得出结论。看起来就变成这样子：</p>
<blockquote>
<p>我的最终结论是：观点A：aaaaaa</p>
<p>原因如下：</p>
<p>观点A：aaaaaa</p>
<p>支持的理由如下：</p>
<blockquote>
<ol>
<li>a1……</li>
<li>a2……</li>
<li>a3……</li>
</ol>
</blockquote>
<p>不支持的理由如下：</p>
<blockquote>
<ol>
<li>d1……</li>
<li>d2……</li>
<li>d3……</li>
</ol>
</blockquote>
<p>观点B: bbbbbb</p>
<p>支持的理由如下：</p>
<blockquote>
<p>……</p>
</blockquote>
<p>不支持的理由如下：</p>
<blockquote>
<p>……</p>
</blockquote>
<p> 分析如下：……</p>
</blockquote>
<p>最后的分析部分是根据实际情况，客观事实，判断依据等相关的内容做分析判断，或者根据实际情况采用统计分析的方法对多种方案做出选择。这样做至少相对客观，也比较接近于第二种方式。</p>
<p>以上第2点比较好理解，我这里就不做解释。</p>
<p>第3点则说到要monitor your thought。怎样的人才能做到monitor your thought呢？</p>
<p>我觉得是要有一定的元认知（metacognition）能力。</p>
<p>关于元认知能力，维基百科的解释是：</p>
<blockquote>
<p>Metacognition is “cognition about cognition”, “thinking about thinking”, or “knowing about knowing” and higher order thinking skills. </p>
<p>元认知是“对认知的认知”，“对思考的思考”或者“对认识的认识”以及更高阶的思维技巧。</p>
</blockquote>
<p>牛津词典的解释是：</p>
<blockquote>
<p>Awareness and understanding of one’s own thought processs.</p>
<p>对自己思考过程的认知与理解</p>
</blockquote>
<p>以上，不管对自己的认知的认知，还是对自己思考过程的认知与理解，都需要元认知能力。那么要达到对自己思考的监控，那自然也需要有元认知能力作为基础。</p>
<p>关于元认知能力，李笑来老师在<a href="http://zhibimo.com/read/xiaolai/zuo-xiang-qi-cheng/chapter2.html" target="_blank" rel="external">知笔墨上他们的一本书里</a>及得到上的专栏有过详细的解释。可以直接点进去看看（我自己是通过这两个地方了解到元认知能力的）。你也可以通过参考我之前写过的文章<a href="http://daijianlin.com/2016/10/04/%E6%88%91%E7%9A%84%E5%85%83%E8%AE%A4%E7%9F%A5%E8%83%BD%E5%8A%9B%E5%BC%80%E5%A7%8B%E8%A2%AB%E6%BF%80%E6%B4%BB/" target="_blank" rel="external">《我的元认知能力开始被激活》</a>的文章。</p>
<p>有了这个元认知能力以后，我们就能够对我们的思考进一步思考，从而达到监控的目的，当然这也说起来比较抽象。我用上面说到过的例子来演练和反思一下这个过程：</p>
<blockquote>
<p>啊？我之前这种想出一个观点，然后提供各种证据来支持它的做法竟然是错误的，没有意义的，得出的结论会带有很强的主观性，因为不论什么观点，经常很容易能找到支持的理由。</p>
</blockquote>
<p>恍然大悟：</p>
<blockquote>
<p>啊？原来是这样的啊！应该要考虑各种观点，以及各自支持他们的论据和反对的理由等等。</p>
</blockquote>
<p>进而：</p>
<blockquote>
<p>这道理其实挺简单的啊！之前我怎么竟然完全没有想到？是我当年的元认知能力不够吗？</p>
</blockquote>
<p>进一步：</p>
<blockquote>
<p>那现在我知道了，我现在开始应该都这么做才对。</p>
</blockquote>
<p>可是：</p>
<blockquote>
<p>在要形成新的观点时，我还是总是不由自主地优先考虑自己想到的观点哟……</p>
</blockquote>
<p>是啊：</p>
<blockquote>
<p>终于又深刻体会了一遍什么叫“知易行难“啊！我就不信我搞不定！</p>
</blockquote>
<p>后来，经过自己不断的挣扎，自己形成观点更加客观了，品质也更加高了。监控自己的想法需要元认知能力。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/15/XPM-Primecoin-分析报告-戴建林/" itemprop="url">
                  XPM(Primecoin)分析报告-戴建林
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-15T09:02:23+08:00" content="2016-10-15">
              2016-10-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/币种研究/" itemprop="url" rel="index">
                    <span itemprop="name">币种研究</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/15/XPM-Primecoin-分析报告-戴建林/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/10/15/XPM-Primecoin-分析报告-戴建林/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="XPM-Primecoin-分析报告-戴建林"><a href="#XPM-Primecoin-分析报告-戴建林" class="headerlink" title="XPM(Primecoin)分析报告-戴建林"></a>XPM(Primecoin)分析报告-戴建林</h1><p><strong>Report Outline</strong></p>
<ol>
<li>总结 </li>
<li>关于XPM(primecoin)<br> 2.1. 什么是XPM？<br> 2.2. XPM（素数币）的优点：<br> 2.3. 奖励历史 </li>
<li>XPM解决了什么问题？ </li>
<li>价格走势 </li>
<li>流动性<br> 5.1 交易量<br> 5.2 上线的交易所<br>附录1：社交媒体活跃度<br> Facebook热度<br> 推特热度：<br>附录2：以太坊创始人评价(2013) </li>
</ol>
<h2 id="1-总结"><a href="#1-总结" class="headerlink" title="1. 总结"></a>1. 总结</h2><p><strong>XPM素数币是第一个拿出可行的解决方案的基于工作量证明的加密货币。在2013年刚出来的时候风光过一阵子，当初连以太坊创始人Vitalik Buterin都对它抱有一定希望（具体看附录的链接文章）。但是后面没落下来，价格也是下跌挺多，似乎没什么机会上涨。</strong></p>
<p><strong>所以个人判断是： 可能对科研上有一定贡献，目前投资估计价值不大。</strong></p>
<h2 id="2-关于XPM-primecoin"><a href="#2-关于XPM-primecoin" class="headerlink" title="2. 关于XPM(primecoin)"></a>2. 关于XPM(primecoin)</h2><h3 id="2-1-什么是XPM？"><a href="#2-1-什么是XPM？" class="headerlink" title="2.1. 什么是XPM？"></a>2.1. 什么是XPM？</h3><p>Primecoin is an innovative cryptocurrency, a form of digital currency secured by cryptography and issued through a decentralized mining market. Derived from Satoshi Nakamoto’s Bitcoin, Primecoin introduces an unique form of proof-of-work based on prime numbers, and is the first cryptocurrency in the world designed with scientific computing as its work.<br>Primecoin,中文叫质数币或者素数币，是一种创新的加密货币，一种通过加密技术确保的数字货币形式，通过分散的矿业市场发行。 源于中本聪的比特币，Primecoin引入了基于素数的独特形式的工作量证明，并且是世界上第一个以科学计算为工作的加密货币。</p>
<h3 id="2-2-XPM（素数币）的优点"><a href="#2-2-XPM（素数币）的优点" class="headerlink" title="2.2. XPM（素数币）的优点"></a>2.2. XPM（素数币）的优点</h3><p>The innovative prime proof-of-work in Primecoin not only provides security and minting to the network, but also generates a special form of prime number chains of interest to mathematical research. Thus primecoin network is energy-multiuse, compared to bitcoin network. Primecoin is designed to sustain a prosperous mining market and high level of security, while maintaining good scarcity property like gold. Primecoin also processes payment transactions 10x faster than bitcoin network.<br>Primecoin的创新的主要工作证明不仅为网络提供安全和“造币厂”，而且还形成了对特殊形式的素数链数学研究的兴趣。 因此，与比特币网络相比，primecoin网络是能量多用途的。 Primecoin旨在维持繁荣的采矿市场和高水平的安全性，同时保持良好的稀缺性财产，如黄金。 Primecoin处理支付交易比比特币网络快10倍。</p>
<h3 id="2-3-奖励历史"><a href="#2-3-奖励历史" class="headerlink" title="2.3. 奖励历史"></a>2.3. 奖励历史</h3><p>电子前沿基金会提供55万美元价值的奖品给第一个发现数字长度超过100万，10万，亿和1亿的素数。目前前两个奖项已经被拿走。“大互联网梅森素数搜索”从1996年以来一直在寻找大素数，世界各地大学的数学家们都在参与。美国田纳西大学马汀分校为寻找素数是有用的提供了一系列说法：除了获得荣耀以外，在数论领域有很多副产品，激励计算机硬件开发，了解素数背后的工作机制，例如，能够深度预测素数间隔的素数理论，在用来寻找素数分布中得到使用。在这里，希望是，如果素数币能够大规模推广，人们能够更有效的找到坎宁安链和双坎宁安链，甚至可能突破性的找到这些数列出现的规律。</p>
<h2 id="3-XPM解决了什么问题？"><a href="#3-XPM解决了什么问题？" class="headerlink" title="3. XPM解决了什么问题？"></a>3. XPM解决了什么问题？</h2><p>素数币是市场上第一个没有采用Hash工作量证明机制的加密货币，挖矿过程本身就存在着科学价值。这项研究为其他种类的工作量证明的计算提供了分布式计算的参考价值。作为全世界第一个为数学问题而提出的电子货币。质数币可以给数学学术界带来一定的科研贡献。</p>
<p>质数在数学界中，存在着很多的疑难问题，比如著名的哥德巴赫猜想、黎曼猜想、孪生质数猜想、费马数、梅森质数等等，这些问题的解决，可以对人类的科学技术的发展，起到非常重要的促进作用XPM挖矿和传统的比特币挖矿原理截然不同，传统的比特币挖矿，只是简单的对一组密码进行暴力破解，而XPM的设计理念，是集合大家所有人的计算机能力，对学术界中的疑难问题进行破解，比如寻找最大的质数等等。这将对人类的科技进步带来一定程度上的帮助。</p>
<h2 id="4-价格走势"><a href="#4-价格走势" class="headerlink" title="4. 价格走势"></a>4. 价格走势</h2><p>2013年的时候价格彪到0.015BTC（当初人民币8元），曾经排行到电子货币的第三名，但是，现在价格却只有0.00010877BTC（人民币0.45元左右）。P网的价格去年到现在一整年的时间，价格下降了三分二（从0.00028BTC左右到0.00010BTC左右）。</p>
<p><img src="https://raw.githubusercontent.com/daijianlin/daijianlin.github.io/master/images/XPM-P.png" alt=""></p>
<h2 id="5-流动性"><a href="#5-流动性" class="headerlink" title="5. 流动性"></a>5. 流动性</h2><p>目前流动性比较差。因为交易量低，上线的交易所也低，详细看下面两小节。</p>
<h3 id="5-1-交易量"><a href="#5-1-交易量" class="headerlink" title="5.1 交易量"></a>5.1 交易量</h3><p>最近日均交易量才6个比特币左右。</p>
<h3 id="5-2上线的交易所"><a href="#5-2上线的交易所" class="headerlink" title="5.2上线的交易所"></a>5.2上线的交易所</h3><p>曾经上线过下面的几个交易所，但是好多个交易所已经下架了，但是他们的官网还是放着，都没有做更新的样子。</p>
<blockquote>
<ul>
<li>BTC-e（已经下架）</li>
<li>Cryptsy BTC LTC with XPM Market Section by BitJohn and bigvern</li>
<li>Crypto-Trade USD BTC PPC by neotrix</li>
<li>Vircurex USD EUR BTC PPC</li>
<li>Coins-E by minus</li>
<li>Coinmkt</li>
<li>btc38(比特时代) CNY</li>
<li>Bter(比特儿) CNY BTC</li>
<li>btcltc(比特莱)</li>
<li>CoinEx</li>
<li>Gatecoin (Under Development)</li>
</ul>
</blockquote>
<h2 id="附录1：社交媒体活跃度"><a href="#附录1：社交媒体活跃度" class="headerlink" title="附录1：社交媒体活跃度"></a>附录1：社交媒体活跃度</h2><h3 id="Facebook热度"><a href="#Facebook热度" class="headerlink" title="Facebook热度"></a>Facebook热度</h3><p>没什么人气。<br><img src="https://raw.githubusercontent.com/daijianlin/daijianlin.github.io/master/images/XPM-facebook.png" alt=""></p>
<h3 id="Twitter热度"><a href="#Twitter热度" class="headerlink" title="Twitter热度"></a>Twitter热度</h3><p>也没什么更新。<br><img src="https://raw.githubusercontent.com/daijianlin/daijianlin.github.io/master/images/XPM-Twitter.png" alt=""></p>
<h2 id="附录2：以太坊创始人评价-2013"><a href="#附录2：以太坊创始人评价-2013" class="headerlink" title="附录2：以太坊创始人评价(2013)"></a>附录2：以太坊创始人评价(2013)</h2><p>以下是以太坊创始人Vitalik Buterin 2013对XPM的评价：</p>
<p>原文：<a href="http://tinyurl.com/xpmjianlin" target="_blank" rel="external">http://tinyurl.com/xpmjianlin</a></p>
<p>翻译：<a href="http://dwz.cn/xpmjianlin" target="_blank" rel="external">http://dwz.cn/xpmjianlin</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/04/我的元认知能力开始被激活/" itemprop="url">
                  我的元认知能力开始被激活
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-04T23:43:47+08:00" content="2016-10-04">
              2016-10-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/个人成长/" itemprop="url" rel="index">
                    <span itemprop="name">个人成长</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/04/我的元认知能力开始被激活/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/10/04/我的元认知能力开始被激活/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>听过笑来老师说过“读书要只字不差地阅读”之后，发现实践起来其实并不容易。因为之前养成了不好的习惯：看书看的挺快，遇到一知半解的东西跳过，而且是跳过之后就不回头过来琢磨和思考。</p>
<p><strong>这就很糟糕了。</strong></p>
<blockquote>
<p>啊？我之前这种比较快的阅读方式竟然是错的，没有意义的，东西只不过在脑中过了一遍而已，没有留下深刻的记忆，一段时间过后也就完全忘记了……</p>
</blockquote>
<p>恍然大悟：</p>
<blockquote>
<p>啊？原来是这样的啊！</p>
</blockquote>
<p>进而：</p>
<blockquote>
<p>这道理其实挺简单的啊！之前我怎么竟然完全没有想到？作为一个把新概念3里面的几十篇文章反复背诵过几百遍的人，我怎么就想不到读书要只字不差地阅读？甚至只字不差地思考？只字不差地琢磨？</p>
</blockquote>
<p>进一步：</p>
<blockquote>
<p>那现在我知道了，我现在开始应该都这么做才对。</p>
</blockquote>
<p>可是：</p>
<blockquote>
<p>在阅读的时候，我还是总是不由自主地加快速度，哪怕这句话读过没有完全理解，也是一直往前阅读？</p>
</blockquote>
<p>是啊：</p>
<blockquote>
<p>终于又深刻体会了一遍什么叫“知易行难啊！我就不信我搞不定！</p>
</blockquote>
<p>于是：</p>
<blockquote>
<p>我有开始了另外的征程……每次要往前走的时候，控制自己，践行《Beyond Feelings…..》里说的：</p>
<blockquote>
<p>“Effective thinkers exert control over their metal life, direct their thoughts rather than being directed by them, and withhold their endorsement of any idea - even their own - until they have tested and confirmed it”</p>
</blockquote>
</blockquote>
<p>笑来老师在得到中的解释说到了问题的本质：</p>
<blockquote>
<p>“越是简单的事情，其实越容易被人忽略。因为我们总是以为自己已经理解了这些表层的意思，而不再去深挖其中的本质。”</p>
</blockquote>
<p>从最底层来看，元认知能力起作用的方式：</p>
<blockquote>
<p>哦，我原来(正在)是这么想的：我赶紧要把这边书读完，读完了就可以读另外一本了……<br>嗯？我这么想难道是不对的吗？是的，是不对。这样不是为了读书而读书，搞形式化吗？本质上是在自己欺骗自己呀？<br>啊？我应该这么想才对：读这本好书，我要读无数遍，读到懂为止，通过各种方式读，做笔记，做记录，反复阅读，向后总结的同时，向前预期。你想啊，真正有用的知识都是比较不容易掌握的，再细细地想一下，大家都容易懂的知识是不是相对比较没有价值？而当你完全掌握好一本好书的时候，你再接着去看另外一本书，当你读书读到一定数量，积累到一定水平的时候，会发现自己的理解能力越来越强，自己的读书速度会越来越快……</p>
</blockquote>
<p>这段通过认真阅读，我竟然发现我已经掌握了一个很重要的能力，这个能力是：</p>
<blockquote>
<p>不管周围的环境多么的吵，我竟然可以雷打不动地看书……哇，这种感觉太棒了。进而，不管周围的环境多么吵，我竟然可以做我想做的几乎任何的事情？哇，这种感觉amazing……</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/04/我的精读实践初心得/" itemprop="url">
                  我的精读实践初心得
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-04T23:38:53+08:00" content="2016-10-04">
              2016-10-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/个人成长/" itemprop="url" rel="index">
                    <span itemprop="name">个人成长</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/04/我的精读实践初心得/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/10/04/我的精读实践初心得/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们为什么要读书？</p>
<blockquote>
<p>改变生活。</p>
</blockquote>
<p>这是我听过的最朴素的回答。</p>
<p>读书无用论流行了很长时间了，大概从2000年左右高考开始扩招开始，就一直在流行着读书无用论—因为很多人读了大学毕业后找不到工作，甚至有些高考考上名牌大学后毕业后竟然找不到工作，只好回到家里呆着。</p>
<p>可是，很多人（包括以前的我）其实没有深层次地去分析原因。我给出的答案是：上学读的书没有用起来，当然无用了。读的书没有用起来，会起作用，那天理何在啊？</p>
<p>在我骨子里，我其实是从小就坚信读书会有用的人（那是即使我真不知道会有什么用，我却依然坚信）。假如没有这份坚信，也不会有这篇文章。</p>
<p>我们先从最简单的怎样读书开始说起。</p>
<p>毫无夸张地讲，很多人这辈子被害得最惨的之一是快速阅读。我也不例外，这个快速阅读的概念犹如魔鬼一样的跟随着我，让我深受其害，我想这也是我们教育失败的原因之一吧，在我们上学的时候，很多错误的理念一直伴随着我们，被这些错误的理念毒害的时候，没有人给我们指导。本质的原因可能是中国的老师整体水平实在是次。</p>
<p>直到有一天，我看到了李笑来老师的《人人都能用英语》里面提到：阅读只有一种—精读。我才恍然大悟。里面提到，好书，应该要这样读：</p>
<blockquote>
<ul>
<li>挣扎着搞清楚每一句话的确切含义。运用一切可以运用的手段— 查词典，查语法书，甚至去查google。</li>
<li>理解每句话之间、每个段落之间的关系。处理段落有另外一个任务— 概括。</li>
<li>整理词汇。要知道，读完一篇文章之后，自己动手整理词汇，远比背单词书效率高出许多— 可惜，大多数人并不相信。</li>
<li>反复阅读若干遍。读着读着就可能发现很多第一次读并没有注意到的东西。</li>
<li>复述文章。能够书面或者口头复述刚刚度过的文章，实际上需要很多综合能力：记忆力、逻辑能力、转述能力、重新组织能力、再理解能力等等。</li>
<li>养成若干天后复习的习惯。</li>
</ul>
</blockquote>
<p>你要知道，即使看到这么朴素的读书方法，大部分人其实只是想一想而已，不会真正实践的，想完了后第二天读书的时候还是没按照上面的方法来。我就是这样的人。</p>
<p>我在几个月前就看到了这本书，在看这本书的时候，也重点地把以上这部分内容圈起来。可是，过几天我就完全忘记了……</p>
<p>直到有一天，我听了笑来老师的演讲—讲他是如何读书的，里面提到他写的这篇文章，我才再次被触动，再次翻开这篇文章，这次，触动我心灵的其实是，假如我再这样下去，下辈子（七年就是一辈子）我可能还是个原始人，于是，我行动了起来……</p>
<p>行动了后，才知道自己是多么的无知，之前读书，很多细节都是一知半解自己却为了追求速度而放过，遇到不懂的甚至因为嫌麻烦，就不动手去查资料。举个例子，有时候，我看到书的内容（我说的是英文原版书哦，因为最近都看英文原版书籍），我每句话都读懂了，但是没有深度思考，看了这句，忘记了上一句，看书变成了只是过场，大脑没有留下任何记忆。更别提可以把学到的在生活学习中用起来了。有时候甚至是大脑的“思路”没有跟上眼睛的“思路”。怎么办呢？怎么办呢？有没有解决办法？解决办法就是按照笑来老师说的方法，一字不落地记住上面的话，跟着去实践。</p>
<p>在读书这条路上，要真正达到改善生活，是需要时间来发酵的。让我们拭目以待吧……</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/22/通过自学多维度打造竞争力/" itemprop="url">
                  通过自学多维度打造竞争力
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-22T00:10:47+08:00" content="2016-09-22">
              2016-09-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/个人成长/" itemprop="url" rel="index">
                    <span itemprop="name">个人成长</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/22/通过自学多维度打造竞争力/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/09/22/通过自学多维度打造竞争力/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们这一生，有必要不停地问自己（主要从笑来老师得到专栏摘录）：</p>
<blockquote>
<p>到目前为止，你有什么是真正让自己值得骄傲的？</p>
<p>赚钱能力，是个永远绕不开的话题，只要你还在这个世界上活着，那么问问自己自己的哪个专业技能能让自己比掉80%的人？除此之外，你还可以围绕着它打造多少个维度？以便打造出一个他人无法招架的竞争力？</p>
</blockquote>
<p>分享一下我自己的回答：首先，如果有什么值得让我骄傲的话，就是一路上走过来，都只根据自己的想法和思考来生活。我感谢我的父母亲，放任我自由成长，从读小学到读大学研究生，都是我自己选择的结果，从农村来到城市，然后最终在老家与城市之间往来，能够做到没有忘记老家的同时还能在城市发展。如果你有幸也是很多事情都是自己做选择，那你也是很幸福的，自己选择了，就要勇往直前！</p>
<p>其次，关于专业技能，跟中国人对比起来的话，我大概英文写作水平能比掉80%的人；我对文档的处理，做事情对细节的把控，应该处于10%以内。</p>
<p>我想我必须在以下几个方面打造自己的竞争力：</p>
<blockquote>
<ul>
<li>写作能力</li>
<li>沟通</li>
<li>逻辑思考</li>
<li>数据分析统计概率</li>
<li>理财</li>
<li>计算机编程</li>
</ul>
</blockquote>
<p>我的打造方法对应如下：</p>
<blockquote>
<p>首先，我现在给自己定的目标是一周要写至少5篇文章。通过不断地写作和读书来促进自己的写作能力、沟通能力及逻辑思考能力。其中逻辑思考首先要从看烂那边《beyond feelings》开始……所以说这几个基本都是靠自学来获取知识。</p>
<p>其次，数据分析统计概念，我会通过新生大学同学们建立的社群来获取相关资料，这个相关的资料在这里可以获取到<a href="https://zhuanlan.zhihu.com/p/22001341" target="_blank" rel="external">数据分析入门群Checklist</a>，就通过跟他们的沟通学习交流，当然最终还是要反应到自学上。</p>
<p>再次，关于理财，自己已经在践行，我已经定期拿出每个月的一部分钱拿去投资，当做是这些钱可能会没掉的去投资，当然还有一部分投资是保本的投资。</p>
<p>最后，关于计算机编程，其实是我大学时候学习的专业，本来应该成为我的核心竞争力的可惜却被我丢掉了，有机会捡回来的，我主要打算还是跟笑来老师学习，跟着老师的节奏走。</p>
</blockquote>
<p>总而言之就是两个字：</p>
<blockquote>
<p><strong>自学</strong></p>
</blockquote>
<p>要做以上的事情，是需要建立在自己工作比较稳定的基础上，不要放弃目前的工作，因为目前的工作是很重要的，是为做以上事情做基础后盾的，家庭开销需要我用这份工作来支持。没有了这份工作当然也不一定是坏事，但是假如是不做我当前的工作，那么多维度打造自己竞争力的计划得推倒重新写，因为首先是要以自己家庭的基本生活保障作为前提和基础的。当然，也许有一天我会放开自己的思想负担，自由地选择属于自己的道路前进，过下一个属于自己的更不一样的七年（七年就是一辈子）。</p>
<p>我答应了李笑来老师，我要帮他一个忙，也许对你有帮助哦！</p>
<p><img src="http://ww4.sinaimg.cn/mw690/006gNvXEgw1f7aff0zkyoj30ku0vrgnu.jpg" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/19/摆脱“浪费时间”的行为，赢得成长的机会/" itemprop="url">
                  摆脱“浪费时间”的行为，赢得成长的机会
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-19T00:38:34+08:00" content="2016-09-19">
              2016-09-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/个人成长/" itemprop="url" rel="index">
                    <span itemprop="name">个人成长</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/19/摆脱“浪费时间”的行为，赢得成长的机会/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/09/19/摆脱“浪费时间”的行为，赢得成长的机会/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>不知道你是否有过类似下面的某种行为？</p>
<blockquote>
<ul>
<li>“看一看我投资的某个资产涨了没有……”</li>
<li>“看一看得到的评论有没有被选上精选啊……”</li>
<li>“刷一刷NBA勇士队的比分（文字直播）有没有领先……“</li>
<li>”刷新一下是否客户有给我回复新邮件了……“</li>
<li>……</li>
</ul>
</blockquote>
<p>上面列举到的，说的其实是曾经的我有过的行为，毫无夸张地讲，这些行为其实是在浪费可以促进自己成长的注意力，进而浪费自己的生命：</p>
<blockquote>
<ul>
<li>每天盯着看资产有没有涨是没有用的，时不时地看这个基本是浪费时间，无关成长。</li>
<li>这个就更没有意义，起初可能还想着被评为精选说不定可以得到礼物。可是啊，那个不应该是重点，重点是什么呢？还是自己的成长。</li>
<li>看NBA这样的文字直播刷比方，从我自己是个伪球迷的角度来看，大概就是一种凑热闹的行为而已。跟成长扯不上任何关系。对其他人比如说某个要往打篮球发展的人来说，可能看视频才是能促进自己观察和成长的。</li>
<li>经常刷邮件的人，也是不懂珍惜自己注意力的，首先，要明白邮件其实是一个”异步“通讯工具而不是一个”同步“通讯工具（所谓“异步”，指的是信息的发送和响应之间可以距离很长的时间）。如果经常很急的去刷，只能说明自己是个没耐心的，不懂得如何分配时间的人。更何况再怎么急的邮件也不会因为差个几分钟没查收，对方就不理你了（当然特殊情况除外），说得难听点，假如对方是这样的，也是不值得你珍惜。</li>
<li>……</li>
</ul>
</blockquote>
<p>在我看来，有过类似以上的行为肯定也是正常，但是，长时间或者长期处于类似这些行为当中，就不正常了！一旦发现自己长时间处于上面类似这些行为当中，一定把自己拉回来。具体要怎么做呢？</p>
<h2 id="首先，要思考……"><a href="#首先，要思考……" class="headerlink" title="首先，要思考……"></a>首先，要思考……</h2><p>也不要小看这个貌似看起来很简单的思考，想想那些花了几千块钱甚至就几百块钱在股市里，却像中毒似的每天盯着屏幕看涨跌曲线的”股民们“吧。</p>
<p>所以，我们都必须时不时地提醒自己，要思考，要时刻能思考意识到自己处于这种行为当中。</p>
<h2 id="其次，把注意力聚焦到成长上"><a href="#其次，把注意力聚焦到成长上" class="headerlink" title="其次，把注意力聚焦到成长上"></a>其次，把注意力聚焦到成长上</h2><p>经过了上面思考的步骤后，要懂得马上”抽身出来“，转移自己的注意力到能促进自己成长的事情上。按照李笑来老师的说法，上面的那些行为其实都是浪费自己注意力的行为，而注意力是我们最宝贵的财富，要把注意力放在自己的成长上面。</p>
<h2 id="最后，要从本质上解决问题"><a href="#最后，要从本质上解决问题" class="headerlink" title="最后，要从本质上解决问题"></a>最后，要从本质上解决问题</h2><p>本质的东西是什么呢？是自己没事情可以做吗？不，怎么会没事情呢？要做的事情多着呢……</p>
<blockquote>
<ul>
<li>实现财富自由</li>
<li>学习投资理财</li>
<li>学习编程</li>
<li>学习英语</li>
<li>多陪陪自己爱的人</li>
<li>……</li>
</ul>
</blockquote>
<p>有时候我都觉得恨不得自己一天有48小时呢？那为什么还是会出现上面的行为？本质上是没有合理安排自己的时间。那就要给自己做计划。至于要怎么给自己做计划，笑来老师在《把时间当作朋友》中的第三章第9节<a href="http://zhibimo.com/read/xiaolai/ba-shi-jian-dang-zuo-peng-you/Chapter3.html" target="_blank" rel="external">计划</a>讲的就很透彻。直接前往查看呗……</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/marcdai.png"
               alt="DaiJianlin" />
          <p class="site-author-name" itemprop="name">DaiJianlin</p>
          <p class="site-description motion-element" itemprop="description">时刻用一颗谦卑的心来面对这个世界的人和事，在自己所建立的原则的基础上努力做事，人生终将美满。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">31</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://cn.linkedin.com/in/marcdai" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-linkedin-square"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/p/1005053542339090?is_all=1" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/marc_dai" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/daijianlin" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/daijianlin" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/e1707c67ab73/latest_articles" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  简书
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DaiJianlin</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'daijianlin';
      var disqus_identifier = 'index.html';
      var disqus_title = "";
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  




  
  
  

  

  

</body>
</html>
